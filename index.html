<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ - Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap">
    <style>
        :root {
            --primary: #0072ff;
            --secondary: #00c6ff;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --purple: #9b59b6;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
            padding: 30px;
            width: 100%;
            max-width: 450px;
            animation: slideIn 0.5s ease;
            display: none;
            position: relative;
            overflow: hidden;
        }

        .card.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ø´Ø§Ø±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
        .card-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Ø±Ø£Ø³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
        .card-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .card-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .card-title {
            color: var(--dark);
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .card-subtitle {
            color: #666;
            font-size: 14px;
        }

        /* Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-label {
            display: block;
            color: var(--dark);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .input-field {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 114, 255, 0.1);
        }

        .input-field.error {
            border-color: var(--danger);
        }

        .input-hint {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        /* Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ */
        .voice-btn {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--info);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .voice-btn:hover {
            background: #2980b9;
            transform: translateY(-50%) scale(1.1);
        }

        .voice-btn.listening {
            background: var(--danger);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .voice-status {
            position: absolute;
            left: 70px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            display: none;
            z-index: 2;
        }

        /* Ø®ÙŠØ§Ø± ØªØ°ÙƒØ±Ù†ÙŠ */
        .remember-group {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .remember-checkbox {
            width: 20px;
            height: 20px;
            margin-left: 10px;
            cursor: pointer;
        }

        .remember-label {
            color: #666;
            font-size: 14px;
            cursor: pointer;
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            box-shadow: 0 4px 15px rgba(0, 114, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 114, 255, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #43cea2, #185a9d);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f2994a, #f2c94c);
            color: #333;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #2980b9);
            color: white;
        }

        .btn-purple {
            background: linear-gradient(135deg, var(--purple), #8e44ad);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn-small:active {
            transform: translateY(0);
        }

        /* ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
        .card-image {
            width: 100%;
            max-width: 250px;
            margin: 20px auto;
            display: block;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        .alert {
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .alert-error {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            color: var(--danger);
            border: 2px solid var(--danger);
        }

        .alert-success {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            color: var(--success);
            border: 2px solid var(--success);
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            color: #f57c00;
            border: 2px solid var(--warning);
        }

        .alert-info {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: var(--info);
            border: 2px solid var(--info);
        }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª */
        .counter-box {
            background: linear-gradient(135deg, #f0f7ff, #d6e4ff);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            border: 2px solid rgba(0, 114, 255, 0.2);
        }

        .counter-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }

        .counter-label {
            font-size: 14px;
            color: #666;
        }

        /* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--dark);
        }

        .modal-close {
            background: var(--danger);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--purple), #8e44ad);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1001;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            cursor: pointer;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-icon {
            font-size: 28px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
            font-size: 14px;
        }

        .footer-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        /* Ø´Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .badge {
            background: var(--danger);
            color: white;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 20px;
            text-align: center;
            display: none;
        }

        .btn-relative {
            position: relative;
        }

        /* Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }
            
            .card-title {
                font-size: 20px;
            }
            
            .btn {
                padding: 14px;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .card {
                padding: 15px;
            }
            
            .card-title {
                font-size: 18px;
            }
            
            .input-field {
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="card active" id="loginPage">
        <div class="card-header">
            <span class="card-icon">ğŸ”</span>
            <h1 class="card-title">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h1>
            <p class="card-subtitle">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</p>
        </div>
        
        <div class="input-group">
            <label class="input-label">ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ (6 Ø£Ø±Ù‚Ø§Ù…)</label>
            <div style="position: relative;">
                <input type="tel" id="loginCode" class="input-field" placeholder="900901" maxlength="6" inputmode="numeric">
                <button class="voice-btn" id="voiceBtn" title="Ø¥Ø¯Ø®Ø§Ù„ ØµÙˆØªÙŠ" onclick="toggleVoiceRecognition()">
                    ğŸ¤
                </button>
                <div class="voice-status" id="voiceStatus"></div>
            </div>
            <div class="input-hint">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…</div>
        </div>
        
        <div class="remember-group">
            <input type="checkbox" id="rememberMe" class="remember-checkbox">
            <label for="rememberMe" class="remember-label">ØªØ°ÙƒØ±Ù†ÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²</label>
        </div>
        
        <button class="btn btn-primary" onclick="login()">
            <span>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</span>
            <span>â†’</span>
        </button>
        
        <div class="alert" id="loginAlert"></div>
        
        <div class="footer">
            <p>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨  3.0 | Ø¨Ø±Ù…Ø¬Ø© <a href="#" class="footer-link">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</a></p>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
    <div class="card" id="verifyPage">
        <div class="card-badge">ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚</div>
        <div class="card-header">
            <span class="card-icon">ğŸ”</span>
            <h1 class="card-title">Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</h1>
            <p class="card-subtitle">Ù„Ù„ØªØ­Ù‚Ù‚ ÙÙ‚Ø· - Ù„Ø§ ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</p>
        </div>
        
        <div class="input-group">
            <label class="input-label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
            <input type="tel" id="verifyNatID" class="input-field" placeholder="29901010000000" maxlength="14" inputmode="numeric">
            <div class="input-hint">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 14 Ø±Ù‚Ù…</div>
        </div>
        
        <img src="https://raw.githubusercontent.com/mohamednasr5/id/e83438329b0f009f6eebf61b2797496d744589f2/5.png" 
             class="card-image" alt="Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡ÙˆÙŠØ©">
        
        <button class="btn btn-primary" onclick="checkCard()">
            <span>âœ“ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span>
        </button>
        
        <div class="alert" id="verifyAlert"></div>
        
        <button class="btn btn-secondary" onclick="showPage('loginPage')">
            <span>â†© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„</span>
        </button>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="card" id="mainPage">
        <div class="card-badge" id="placeBadge">Ø§Ù„Ù…ÙƒØ§Ù†</div>
        <div class="card-header">
            <span class="card-icon">ğŸ‘¤</span>
            <h1 class="card-title" id="welcomeTitle">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h1>
            <p class="card-subtitle" id="placeSubtitle">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</p>
        </div>
        
        <div id="notificationContainer"></div>
        
        <div class="counter-box">
            <span class="counter-value" id="entryCounter">0</span>
            <span class="counter-label">Ø¹Ø¯Ø¯ Ø¥Ø¯Ø®Ø§Ù„Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…</span>
        </div>
        
        <div class="input-group">
            <label class="input-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ (Ø§Ø³Ù…Ùƒ Ø£Ù†Øª)</label>
            <input type="text" id="repName" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" maxlength="30" list="repNamesList">
            <datalist id="repNamesList"></datalist>
            <div class="input-hint">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙˆÙ„ÙŠØ³ Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨</div>
        </div>
        
        <div class="input-group">
            <label class="input-label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
            <input type="tel" id="natID" class="input-field" placeholder="29901010000000" maxlength="14" inputmode="numeric">
            <div class="input-hint">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 14 Ø±Ù‚Ù…</div>
        </div>
        
        <img src="https://raw.githubusercontent.com/mohamednasr5/id/e83438329b0f009f6eebf61b2797496d744589f2/5.png" 
             class="card-image" alt="Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡ÙˆÙŠØ©">
        
        <button class="btn btn-primary" onclick="addUser()">
            <span>â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø©</span>
        </button>
        
        <div class="alert" id="addAlert"></div>
        
        <button class="btn btn-purple btn-relative" onclick="showMessagesModal()">
            <span>ğŸ“¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
            <span class="badge" id="messageBadge">0</span>
        </button>
        
        <button class="btn btn-info" onclick="showAdminLogin()">
            <span>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
        </button>
        
        <button class="btn btn-danger" onclick="logout()">
            <span>ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span>
        </button>
        
        <div class="footer">
            <p>Ø¬Ù‡Ø§Ø²: <span id="deviceId"></span> | <span id="currentTime"></span></p>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± -->
    <div class="card" id="adminLoginPage">
        <div class="card-header">
            <span class="card-icon">ğŸ”’</span>
            <h1 class="card-title">ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
            <p class="card-subtitle">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
        </div>
        
        <div class="input-group">
            <label class="input-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="adminPassword" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <div class="input-hint">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
        </div>
        
        <button class="btn btn-primary" onclick="verifyAdmin()">
            <span>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù„ÙˆØ­Ø©</span>
        </button>
        
        <div class="alert" id="adminAlert"></div>
        
        <button class="btn btn-secondary" onclick="showPage('mainPage')">
            <span>â†© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </button>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="card" id="adminPage">
        <div class="card-badge">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
        <div class="card-header">
            <span class="card-icon">âš™ï¸</span>
            <h1 class="card-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</h1>
            <p class="card-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</p>
        </div>
        
        <button class="btn btn-warning" onclick="window.open('stats.html', '_blank')">
            <span>ğŸ“Š ØµÙØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©</span>
        </button>
        
        <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
        <h3 style="margin: 20px 0 10px 0; color: var(--dark);">ğŸ“¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h3>
        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
            <button class="btn-small" style="background: var(--info); color: white;" onclick="loadAdminMessages()">
                ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            </button>
            <button class="btn-small" style="background: var(--danger); color: white;" onclick="deleteAllMessages()">
                ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            </button>
        </div>
        <div id="adminMessagesList" style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; max-height: 300px; overflow-y: auto;">
            <p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</p>
        </div>
        
        <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª -->
        <h3 style="margin: 20px 0 10px 0; color: var(--dark);">ğŸ“Š Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª</h3>
        <div class="input-group" style="margin-bottom: 15px;">
            <label class="input-label">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
            <select id="adminRepSelect" class="input-field" onchange="loadSelectedRepCounter()">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ --</option>
            </select>
        </div>
        
        <div class="counter-box">
            <span class="counter-value" id="adminCounter">0</span>
            <span class="counter-label">Ø¹Ø¯Ø¯ Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯</span>
        </div>
        
        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
            <button class="btn-small" style="background: var(--success); color: white;" onclick="adminIncCounter()">
                â• Ø²ÙŠØ§Ø¯Ø©
            </button>
            <button class="btn-small" style="background: var(--warning); color: white;" onclick="adminDecCounter()">
                â– Ù†Ù‚ØµØ§Ù†
            </button>
            <button class="btn-small" style="background: var(--danger); color: white;" onclick="adminResetCounter()">
                ğŸ—‘ï¸ ØªØµÙÙŠØ±
            </button>
        </div>
        
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ -->
        <h3 style="margin: 20px 0 10px 0; color: var(--dark);">ğŸ‘¥ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
            <button class="btn-small" style="background: var(--info); color: white;" onclick="loadRepsList()">
                ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            </button>
        </div>
        <div id="adminRepsList" style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; max-height: 300px; overflow-y: auto;">
            <p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©</p>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ -->
        <h3 style="margin: 20px 0 10px 0; color: var(--dark);">ğŸ—‘ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
            <button class="btn-small" style="background: var(--warning); color: white; flex: 1;" onclick="resetUsersOnly()">
                ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª ÙÙ‚Ø·
            </button>
            <button class="btn-small" style="background: var(--danger); color: white; flex: 1;" onclick="resetAllData()">
                âš ï¸ ØªØµÙÙŠØ± ÙƒØ§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…
            </button>
        </div>
        
        <button class="btn btn-danger" onclick="showPage('mainPage')">
            <span>â†© Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù„ÙˆØ­Ø©</span>
        </button>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
    <div class="modal" id="messagesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
                <button class="modal-close" onclick="closeMessagesModal()">Ã—</button>
            </div>
            <div id="messagesContent" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div id="notificationArea"></div>

    <!-- Ø§Ù„Ø£ØµÙˆØ§Øª -->
    <audio id="soundDuplicate" preload="auto">
        <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
    </audio>
    <audio id="soundSuccess" preload="auto">
        <source src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg" type="audio/ogg">
    </audio>
    <audio id="soundMessage" preload="auto">
        <source src="https://actions.google.com/sounds/v1/notifications/notification_simple.ogg" type="audio/ogg">
    </audio>

    <!-- Firebase SDK & JavaScript -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, push, remove, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAxnIxtFeAOjYjCIrU5cwYVteuQ18K8Kjc",
            authDomain: "idmanazla.firebaseapp.com",
            databaseURL: "https://idmanazla-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "idmanazla",
            storageBucket: "idmanazla.firebasestorage.app",
            messagingSenderId: "408446131276",
            appId: "1:408446131276:web:976ae54181b5398de5a8e9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…
        const SYSTEM_CONFIG = {
            adminPassword: "521988",
            maxSessionsPerCode: 3,
            sessionTimeout: 30 * 60 * 1000,
            entryPrice: 200
        };

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ÙƒØ§Ù…Ù„Ø© (69 Ù…ÙƒØ§Ù†)
        const PLACES = [
            "1- Ø­ÙŠ Ø§Ù„Ø­Ù…Ø²Ø§ÙˆÙŠ - Ø­Ù…Ø§Ø¯Ù‡ Ø¹Ø¨Ø¯Ù‡ Ù…ØµØ¨Ø§Ø­",
            "2- Ø­ÙŠ Ø§Ù„Ø¬Ø±Ù† 3 - Ø¨Ø¬ÙˆØ§Ø± Ù‚Ù‡ÙˆØ© Ø§Ù„Ù†Ø¬Ø¯ÙŠ",
            "3- Ø­ÙŠ Ø§Ù„Ø¬Ø±Ù† 1 - Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø¸Ù„ÙˆÙ…",
            "4- Ø­ÙŠ Ø§Ù„Ø¬Ø±Ù† 2 - Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… ÙÙ‡ÙŠØ¯",
            "5- Ø­ÙŠ Ø£Ø¨Ùˆ Ø±Ø´Ø§Ø¯ - Ù…Ù‚Ù‡Ù‰ Ø£Ø¨Ùˆ Ø³Ù„ÙŠÙ…Ø§Ù†",
            "6- Ø­ÙŠ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ù… - Ø­Ù…Ø§Ø¯Ø© Ø£Ø¨Ùˆ Ø±Ø´Ø§Ø¯",
            "7- Ø­ÙŠ Ø§Ù„Ø¹Ø²Ø¨Ø© - Ù…Ù†Ø´ÙŠØ© Ù†Ø§ØµØ±",
            "8- Ø­ÙŠ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø¹Ø§Ù… - Ø­Ù…Ø§Ø¯Ù‡ Ø¹Ø³Ø§Ø³Ù‡",
            "9- Ø­ÙŠ Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© - ÙƒØ±ÙŠÙ… Ø´Ù‚Ø±Ù",
            "10- Ø­ÙŠ Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 2 - Ø´Ø±ÙŠÙ Ø¯Ø¨Ø±ÙŠØ§Ø´",
            "11- Ø­ÙŠ Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 3 - Ø£Ø®Ø± Ø´Ø§Ø±Ø¹ 10",
            "12- Ø­ÙŠ Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 1 - Ø´Ø§Ø±Ø¹ Ø§Ù„ÙƒØ§Ø¨ØªÙ†",
            "13- Ø­ÙŠ Ø§Ù„ÙÙ‚Ø§Ø¹ÙŠ - Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… ØºØ²Ù„",
            "14- Ø­ÙŠ Ø§Ù„Ø³Ù„Ù…ÙˆÙ†ÙŠ - Ø­Ø³Ù† Ø§Ù„Ù…Ù†Ø§Ø®Ù„ÙŠ",
            "15- Ø­ÙŠ Ø§Ù„ÙƒÙØ± 1 - Ø§Ù„Ø³Ø§Ø­Ø©",
            "16- Ø­ÙŠ Ø§Ù„ÙƒÙØ± 3 - Ù…Ù„Ø¹Ø¨ Ø¨Ø±Ø´Ù„ÙˆÙ†Ø©",
            "17- Ø­ÙŠ Ø§Ù„ÙƒÙØ± 2 - ØªØ­Øª Ø§Ù„Ø³ÙƒØ©",
            "18- Ø­ÙŠ Ø§Ù„ÙØ¯Ø§Ø¡ 1 - Ø­Ù…Ø§Ø¯Ø© Ø§Ù„ÙƒÙŠØ§Ù„",
            "19- Ø­ÙŠ Ø³ÙˆÙ‚ Ø§Ù„Ø¬Ù…Ù„Ø© - Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ø¹",
            "20- Ø­ÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ø£Ù…Ø§Ù… Ø¹Ù„Ù‰",
            "21- Ø­ÙŠ Ø§Ù„Ø¨Ø± Ø§Ù„ØªØ§Ù†ÙŠ - Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…",
            "22- Ø­ÙŠ Ø§Ù„Ø¨Ø± Ø§Ù„ØªØ§Ù†ÙŠ - Ø§Ù„Ù‡Ø§ÙˆÙŠØ³",
            "23- Ø­ÙŠ Ù…ØµÙ†Ø¹ Ø§Ù„Ø¨ØµÙ„ - ÙˆÙ„ÙŠØ¯ ÙÙ‡ÙŠØ¯",
            "24- Ø­ÙŠ Ù…Ø¯Ø±Ø³Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø§Ù„ Ø´Ù„Ø¨Ø§ÙŠØ©",
            "25- Ø­ÙŠ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© - Ø§Ù„Ø³ÙŠØ¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ",
            "26- Ø­ÙŠ Ø£Ù…Ù† Ø§Ù„Ø¯ÙˆÙ„Ø©",
            "27- Ù‚Ø±ÙŠØ© Ø§Ù„ÙØ±ÙˆØ³Ø§Øª",
            "28- Ù‚Ø±ÙŠØ© Ø£Ø¨Ùˆ Ø§Ù„Ø£Ø®Ø¶Ø±",
            "29- Ù‚Ø±ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…Ù†Ø²Ù„Ø©",
            "30- Ù‚Ø±ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø±Ø©",
            "31- Ù‚Ø±ÙŠØ© Ù…ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©",
            "32- Ù‚Ø±ÙŠØ© Ø¹Ø±Ø¨ Ø²ÙŠØ¯Ø§Ù†",
            "33- Ù‚Ø±ÙŠØ© Ø§Ù„Ø³ØªØ§ÙŠØªØ©",
            "34- Ù‚Ø±ÙŠØ© ÙƒÙØ± Ø­Ø¬Ø§Ø¬",
            "35- Ù‚Ø±ÙŠØ© Ù…ÙŠØª Ø®Ø¶ÙŠØ±",
            "36- Ù‚Ø±ÙŠØ© Ø§Ù„Ù…ÙˆØ§Ø¬Ø¯",
            "37- Ù‚Ø±ÙŠØ© Ø§Ù„Ø¨ØµØ±Ø§Ø·",
            "38- Ù‚Ø±ÙŠØ© Ù…ÙŠØª Ø´Ø±ÙŠÙ",
            "39- Ù‚Ø±ÙŠØ© Ø§Ù„Ø·ÙˆØ§Ø¨Ø±Ø©",
            "40- Ù‚Ø±ÙŠØ© Ø§Ù„Ø¹Ù…Ø§Ø±Ù†Ø©",
            "41- Ù‚Ø±ÙŠØ© Ø£ÙˆÙ„Ø§Ø¯ Ø¨Ø§Ù†Ø§",
            "42- Ù‚Ø±ÙŠØ© Ø£ÙˆÙ„Ø§Ø¯ Ø­Ø§Ù†Ø§",
            "43- Ø¨Ø­Ø± Ø­Ø§Ø¯ÙˆØ«",
            "44- Ù‚Ø±ÙŠØ© Ø§Ù„Ù‚Ø²Ø§Ù‚Ø²Ø©",
            "45- Ù‚Ø±ÙŠØ© Ø§Ù„Ø­ÙˆØªØ©",
            "46- Ù‚Ø±ÙŠØ© Ø£ÙˆÙ„Ø§Ø¯ Ù†ÙˆØ±",
            "47- Ù‚Ø±ÙŠØ© Ø§Ù„Ø®Ù„Ø§ÙŠÙØ©",
            "48- Ù‚Ø±ÙŠØ© Ø§Ù„Ù‚Ø·Ø´Ø©",
            "49- Ù‚Ø±ÙŠØ© Ø§Ù„Ø¬Ù…Ø§Ù…Ù„Ø©",
            "50- Ù‚Ø±ÙŠØ© Ø§Ù„Ø¹Ø²ÙŠØ²Ø©",
            "51- Ù‚Ø±ÙŠØ© Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©",
            "52- Ù‚Ø±ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨Ø§Ù†",
            "53- Ù‚Ø±ÙŠØ© Ø£ÙˆÙ„Ø§Ø¯ Ø¹Ù„Ù…",
            "54- Ù‚Ø±ÙŠØ© Ø£ÙˆÙ„Ø§Ø¯ Ù†Ø§ØµØ±",
            "55- Ù‚Ø±ÙŠØ© Ø¨Ù†ÙŠ Ù‡Ù„Ø§Ù„",
            "56- Ù‚Ø±ÙŠØ© Ø§Ù„Ø´Ø¨ÙˆÙ„",
            "57- Ù‚Ø±ÙŠØ© Ø§Ù„Ø±ÙˆØ¯Ø©",
            "58- Ù‚Ø±ÙŠØ© Ø§Ù„Ù†Ø³Ø§ÙŠÙ…Ø©",
            "59- Ù‚Ø±ÙŠØ© Ø§Ù„Ø¹ØµØ§ÙØ±Ø©",
            "60- Ù‚Ø±ÙŠØ© Ø§Ù„Ø¶Ù‡ÙŠØ±",
            "61- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 1",
            "62- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 2",
            "63- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 3",
            "64- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 4",
            "65- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 5",
            "66- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 6",
            "67- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 7",
            "68- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 8",
            "69- Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ù†Ù‚Ø·Ø© Ø±Ù‚Ù… 9"
        ];

        // Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const LOGIN_CODES = {};
        for (let i = 1; i <= 69; i++) {
            const code = `9009${i.toString().padStart(2, '0')}`;
            LOGIN_CODES[code] = {
                place: PLACES[i - 1],
                placeIdx: i
            };
        }

        LOGIN_CODES["111111"] = {
            place: "ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©",
            placeIdx: 0
        };

        // Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        let systemState = {
            currentUser: null,
            currentPlace: null,
            currentPlaceIdx: null,
            isVerificationMode: false,
            deviceId: null,
            messagesListener: null,
            unreadMessages: 0,
            currentRepName: "",
            selectedAdminRep: ""
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        document.addEventListener('DOMContentLoaded', function() {
            initSystem();
            loadRememberedData();
            updateTime();
            setInterval(updateTime, 1000);
        });

        function initSystem() {
            systemState.deviceId = getDeviceId();
            document.getElementById('deviceId').textContent = systemState.deviceId.substring(0, 8);
            
            initVoiceRecognition();
            
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    const activePage = getActivePage();
                    if (activePage === 'loginPage') login();
                    if (activePage === 'verifyPage') checkCard();
                    if (activePage === 'mainPage') addUser();
                    if (activePage === 'adminLoginPage') verifyAdmin();
                }
            });
        }

        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'dev_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        function loadRememberedData() {
            const savedCode = localStorage.getItem('rememberedCode');
            const rememberMe = localStorage.getItem('rememberMe') === 'true';
            
            if (savedCode && rememberMe) {
                document.getElementById('loginCode').value = savedCode;
                document.getElementById('rememberMe').checked = true;
            }
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('ar-EG') + ' | ' + 
                now.toLocaleDateString('ar-EG');
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ - Ù…Ø¹ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
        let voiceRecognition = null;
        let isListening = false;

        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                voiceRecognition = new SpeechRecognition();
                
                voiceRecognition.lang = 'ar-SA';
                voiceRecognition.continuous = false;
                voiceRecognition.interimResults = false;
                
                voiceRecognition.onstart = function() {
                    isListening = true;
                    const voiceBtn = document.getElementById('voiceBtn');
                    if (voiceBtn) {
                        voiceBtn.classList.add('listening');
                    }
                    showVoiceStatus('ğŸ¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...');
                };
                
                voiceRecognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.replace(/\D/g, '');
                    
                    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù†Ø§ ÙÙŠ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙ‚Ø·
                    const activePage = getActivePage();
                    if (activePage !== 'loginPage') {
                        hideVoiceStatus();
                        return;
                    }
                    
                    if (transcript.length >= 6) {
                        const code = transcript.slice(0, 6);
                        document.getElementById('loginCode').value = code;
                        showVoiceStatus(`âœ… ØªÙ… Ø¥Ø¯Ø®Ø§Ù„: ${code}`);
                        
                        setTimeout(() => {
                            hideVoiceStatus();
                            login();
                        }, 1000);
                    } else {
                        showVoiceStatus('âš  Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù†Ø·Ù‚ 6 Ø£Ø±Ù‚Ø§Ù…');
                    }
                };
                
                voiceRecognition.onerror = function(event) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ:', event.error);
                    showVoiceStatus('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹');
                    setTimeout(hideVoiceStatus, 3000);
                };
                
                voiceRecognition.onend = function() {
                    isListening = false;
                    const voiceBtn = document.getElementById('voiceBtn');
                    if (voiceBtn) {
                        voiceBtn.classList.remove('listening');
                    }
                };
            } else {
                const voiceBtn = document.getElementById('voiceBtn');
                if (voiceBtn) {
                    voiceBtn.style.display = 'none';
                }
            }
        }

        window.toggleVoiceRecognition = function() {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù†Ø§ ÙÙŠ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙ‚Ø·
            const activePage = getActivePage();
            if (activePage !== 'loginPage') {
                return;
            }
            
            if (!voiceRecognition) {
                showAlert(document.getElementById('loginAlert'), 'Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ', 'error');
                return;
            }
            
            if (isListening) {
                voiceRecognition.stop();
            } else {
                voiceRecognition.start();
            }
        };

        function showVoiceStatus(message) {
            const statusEl = document.getElementById('voiceStatus');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.display = 'block';
            }
        }

        function hideVoiceStatus() {
            const statusEl = document.getElementById('voiceStatus');
            if (statusEl) {
                statusEl.style.display = 'none';
            }
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        window.showPage = function(pageId) {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.display = 'none';
            });
        };

        function getActivePage() {
            const activeCard = document.querySelector('.card.active');
            return activeCard ? activeCard.id : null;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        window.login = async function() {
            const code = document.getElementById('loginCode').value.trim();
            const rememberMe = document.getElementById('rememberMe').checked;
            const alertEl = document.getElementById('loginAlert');
            
            if (!code) {
                showAlert(alertEl, 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
                return;
            }
            
            if (code.length !== 6) {
                showAlert(alertEl, 'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø±Ù‚Ø§Ù…', 'error');
                return;
            }
            
            if (rememberMe) {
                localStorage.setItem('rememberedCode', code);
                localStorage.setItem('rememberMe', 'true');
            } else {
                localStorage.removeItem('rememberedCode');
                localStorage.setItem('rememberMe', 'false');
            }
            
            if (code === "111111") {
                systemState.isVerificationMode = true;
                systemState.currentPlace = "ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©";
                showPage('verifyPage');
                return;
            }
            
            const codeData = LOGIN_CODES[code];
            if (!codeData) {
                showAlert(alertEl, 'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            try {
                systemState.currentUser = code;
                systemState.currentPlace = codeData.place;
                systemState.currentPlaceIdx = codeData.placeIdx;
                systemState.isVerificationMode = false;
                
                document.getElementById('welcomeTitle').textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ ÙÙŠ ${codeData.place}`;
                document.getElementById('placeSubtitle').textContent = `Ø§Ù„Ù…ÙƒØ§Ù†: ${codeData.place}`;
                document.getElementById('placeBadge').textContent = `Ø§Ù„Ù…ÙƒØ§Ù† ${codeData.placeIdx}`;
                
                showPage('mainPage');
                
                await loadEntryCounter();
                startMessagesListener();
                
                playSound('success');
                
            } catch (error) {
                showAlert(alertEl, `Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        window.checkCard = async function() {
            const natId = document.getElementById('verifyNatID').value.trim();
            const alertEl = document.getElementById('verifyAlert');
            
            if (!natId) {
                showAlert(alertEl, 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ', 'error');
                return;
            }
            
            if (!/^\d{14}$/.test(natId)) {
                showAlert(alertEl, 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 14 Ø±Ù‚Ù…', 'error');
                return;
            }
            
            try {
                const usersRef = ref(db, 'users');
                const snapshot = await get(usersRef);
                
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    const foundUser = Object.values(users).find(user => user.natID === natId);
                    
                    if (foundUser) {
                        playSound('duplicate');
                        
                        showAlert(alertEl, `
                            âš ï¸ <strong>Ø¨Ø·Ø§Ù‚Ø© Ù…Ø³Ø¬Ù„Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§</strong><br>
                            ğŸ“ Ø§Ù„Ù…ÙƒØ§Ù†: ${foundUser.place}<br>
                            ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${foundUser.repName}<br>
                            â° Ø§Ù„ÙˆÙ‚Øª: ${new Date(foundUser.time).toLocaleString('ar-EG')}
                        `, 'warning');
                    } else {
                        showAlert(alertEl, `
                            âœ… <strong>Ø¨Ø·Ø§Ù‚Ø© Ù†Ø¸ÙŠÙØ©</strong><br>
                            Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
                        `, 'success');
                        playSound('success');
                    }
                } else {
                    showAlert(alertEl, 'Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…', 'success');
                    playSound('success');
                }
                
                document.getElementById('verifyNatID').value = '';
                document.getElementById('verifyNatID').focus();
                
            } catch (error) {
                showAlert(alertEl, `Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        };

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
        window.addUser = async function() {
            const repName = document.getElementById('repName').value.trim();
            const natId = document.getElementById('natID').value.trim();
            const alertEl = document.getElementById('addAlert');
            
            if (!repName) {
                showAlert(alertEl, 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨', 'error');
                document.getElementById('repName').focus();
                return;
            }
            
            if (!natId) {
                showAlert(alertEl, 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ', 'error');
                document.getElementById('natID').focus();
                return;
            }
            
            if (!/^\d{14}$/.test(natId)) {
                showAlert(alertEl, 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 14 Ø±Ù‚Ù…', 'error');
                return;
            }
            
            if (!systemState.currentPlace) {
                showAlert(alertEl, 'Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙƒØ§Ù†', 'error');
                return;
            }
            
            try {
                const usersRef = ref(db, 'users');
                const snapshot = await get(usersRef);
                
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    const foundUser = Object.values(users).find(user => user.natID === natId);
                    
                    if (foundUser) {
                        playSound('duplicate');
                        
                        showAlert(alertEl, `
                            âš ï¸ <strong>Ø¨Ø·Ø§Ù‚Ø© Ù†ØµØ§Ø¨Ø©!</strong><br>
                            ğŸ“ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø£ØµÙ„ÙŠ: ${foundUser.place}<br>
                            ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ø£ØµÙ„ÙŠ: ${foundUser.repName}<br>
                            â° Ø§Ù„ÙˆÙ‚Øª: ${new Date(foundUser.time).toLocaleString('ar-EG')}
                        `, 'warning');
                        
                        const duplicatesRef = ref(db, 'duplicates');
                        await push(duplicatesRef, {
                            duplicatedID: natId,
                            attemptByRep: repName,
                            attemptPlace: systemState.currentPlace,
                            originalPlace: foundUser.place,
                            originalRep: foundUser.repName,
                            timestamp: new Date().toISOString(),
                            deviceId: systemState.deviceId
                        });
                        
                        return;
                    }
                }
                
                const newUserRef = push(usersRef);
                await set(newUserRef, {
                    natID: natId,
                    repName: repName,
                    place: systemState.currentPlace,
                    placeIdx: systemState.currentPlaceIdx,
                    time: new Date().toISOString(),
                    userCode: systemState.currentUser,
                    deviceId: systemState.deviceId
                });
                
                await incrementEntryCounter();
                
                showAlert(alertEl, 'âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                playSound('success');
                
                document.getElementById('natID').value = '';
                document.getElementById('natID').focus();
                
            } catch (error) {
                showAlert(alertEl, `Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        };

        // ØªØ­Ù…ÙŠÙ„ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª
        async function loadEntryCounter() {
            const repName = document.getElementById('repName').value.trim();
            if (!repName) return;
            
            const today = new Date().toISOString().split('T')[0];
            const counterRef = ref(db, `counters/${repName}`);
            
            const snapshot = await get(counterRef);
            let count = 0;
            
            if (snapshot.exists()) {
                const data = snapshot.val();
                if (data.date === today) {
                    count = data.count || 0;
                }
            }
            
            document.getElementById('entryCounter').textContent = count;
        }

        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
        async function incrementEntryCounter() {
            const repName = document.getElementById('repName').value.trim();
            if (!repName) return;
            
            const today = new Date().toISOString().split('T')[0];
            const counterRef = ref(db, `counters/${repName}`);
            
            const snapshot = await get(counterRef);
            let count = 1;
            
            if (snapshot.exists()) {
                const data = snapshot.val();
                if (data.date === today) {
                    count = (data.count || 0) + 1;
                }
            }
            
            await set(counterRef, {
                date: today,
                count: count
            });
            
            document.getElementById('entryCounter').textContent = count;
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function startMessagesListener() {
            const messagesRef = ref(db, 'messages');
            
            onValue(messagesRef, (snapshot) => {
                if (!snapshot.exists()) return;
                
                const messages = snapshot.val();
                const messageArray = Object.entries(messages).map(([id, data]) => ({
                    id,
                    ...data
                }));
                
                const relevantMessages = messageArray.filter(msg => {
                    if (msg.read) return false;
                    
                    if (msg.target === 'all') return true;
                    if (msg.target === `place:${systemState.currentPlace}`) return true;
                    if (msg.target === `rep:${systemState.currentRepName}`) return true;
                    
                    return false;
                });
                
                systemState.unreadMessages = relevantMessages.length;
                updateMessageBadge();
                
                if (relevantMessages.length > 0) {
                    const latestMessage = relevantMessages[relevantMessages.length - 1];
                    showNotification(latestMessage);
                    playSound('message');
                }
            });
        }

        function updateMessageBadge() {
            const badge = document.getElementById('messageBadge');
            if (systemState.unreadMessages > 0) {
                badge.textContent = systemState.unreadMessages;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        function showNotification(message) {
            const notificationArea = document.getElementById('notificationArea');
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div class="notification-icon">ğŸ“¨</div>
                <div class="notification-content">
                    <div class="notification-title">Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
                    <div class="notification-message">${message.text}</div>
                </div>
            `;
            
            notificationArea.appendChild(notification);
            
            notification.onclick = function() {
                showMessagesModal();
                notification.remove();
            };
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        window.showMessagesModal = async function() {
            const messagesRef = ref(db, 'messages');
            const snapshot = await get(messagesRef);
            
            const content = document.getElementById('messagesContent');
            
            if (!snapshot.exists()) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“­</div>
                        <div style="font-size: 18px; font-weight: 600;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</div>
                        <div style="margin-top: 10px;">Ù„Ù… ØªØµÙ„Ùƒ Ø£ÙŠ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</div>
                    </div>
                `;
            } else {
                const messages = snapshot.val();
                const messageArray = Object.entries(messages).map(([id, data]) => ({
                    id,
                    ...data
                }));
                
                const relevantMessages = messageArray.filter(msg => {
                    if (msg.target === 'all') return true;
                    if (msg.target === `place:${systemState.currentPlace}`) return true;
                    if (msg.target === `rep:${systemState.currentRepName}`) return true;
                    return false;
                });
                
                if (relevantMessages.length === 0) {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: #666;">
                            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“­</div>
                            <div style="font-size: 18px; font-weight: 600;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</div>
                        </div>
                    `;
                } else {
                    let html = '';
                    relevantMessages.reverse().forEach(msg => {
                        const isUnread = !msg.read;
                        html += `
                            <div style="background: ${isUnread ? '#fff5f5' : '#f8f9fa'}; border-right: 4px solid ${isUnread ? '#e74c3c' : '#3498db'}; border-radius: 12px; padding: 15px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <strong style="color: #2c3e50;">${getTargetText(msg.target)}</strong>
                                    <small style="color: #666;">${new Date(msg.timestamp).toLocaleString('ar-EG')}</small>
                                </div>
                                <div style="color: #2c3e50; line-height: 1.6;">${msg.text}</div>
                            </div>
                        `;
                    });
                    content.innerHTML = html;
                }
            }
            
            document.getElementById('messagesModal').classList.add('active');
            
            systemState.unreadMessages = 0;
            updateMessageBadge();
        };

        function getTargetText(target) {
            if (target === 'all') return 'ğŸŒ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©';
            if (target.startsWith('place:')) return `ğŸ“ ${target.replace('place:', '')}`;
            if (target.startsWith('rep:')) return `ğŸ‘¤ ${target.replace('rep:', '')}`;
            return target;
        }

        window.closeMessagesModal = function() {
            document.getElementById('messagesModal').classList.remove('active');
        };

        // ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        window.showAdminLogin = function() {
            showPage('adminLoginPage');
        };

        window.verifyAdmin = function() {
            const password = document.getElementById('adminPassword').value;
            const alertEl = document.getElementById('adminAlert');
            
            if (password === SYSTEM_CONFIG.adminPassword) {
                showPage('adminPage');
                loadAdminMessages();
                loadRepsList();
                loadRepsDropdown();
            } else {
                showAlert(alertEl, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            }
        };

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        window.loadAdminMessages = async function() {
            const messagesRef = ref(db, 'messages');
            const snapshot = await get(messagesRef);
            
            const container = document.getElementById('adminMessagesList');
            
            if (!snapshot.exists()) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</p>';
                return;
            }
            
            const messages = snapshot.val();
            const messageArray = Object.entries(messages).map(([id, data]) => ({
                id,
                ...data
            }));
            
            let html = '';
            messageArray.reverse().slice(0, 10).forEach(msg => {
                html += `
                    <div style="background: white; padding: 12px; margin-bottom: 8px; border-radius: 8px; border-right: 3px solid #3498db;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #2c3e50; margin-bottom: 4px;">${getTargetText(msg.target)}</div>
                                <div style="font-size: 13px; color: #666;">${msg.text.substring(0, 80)}${msg.text.length > 80 ? '...' : ''}</div>
                                <small style="color: #999;">${new Date(msg.timestamp).toLocaleString('ar-EG', { dateStyle: 'short', timeStyle: 'short' })}</small>
                            </div>
                            <button class="btn-small" style="background: var(--danger); color: white; margin-right: 10px;" onclick="deleteMessage('${msg.id}')">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        };

        window.deleteMessage = async function(messageId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) return;
            
            try {
                const messageRef = ref(db, `messages/${messageId}`);
                await remove(messageRef);
                loadAdminMessages();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ' + error.message);
            }
        };

        window.deleteAllMessages = async function() {
            const password = prompt('âš ï¸ ØªØ­Ø°ÙŠØ±!\n\nØ£Ù†Øª Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….\nØ£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ£ÙƒÙŠØ¯:');
            
            if (password !== SYSTEM_CONFIG.adminPassword) {
                if (password !== null) {
                    alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
                return;
            }
            
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ù‹Ø§ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) return;
            
            try {
                const messagesRef = ref(db, 'messages');
                await remove(messagesRef);
                loadAdminMessages();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ' + error.message);
            }
        };

        // Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨
        window.loadRepsList = async function() {
            const usersRef = ref(db, 'users');
            const snapshot = await get(usersRef);
            
            const container = document.getElementById('adminRepsList');
            
            if (!snapshot.exists()) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©</p>';
                return;
            }
            
            const users = snapshot.val();
            const repsSet = new Set();
            
            Object.values(users).forEach(user => {
                if (user.repName && user.repName.trim() !== '') {
                    repsSet.add(user.repName);
                }
            });
            
            const repsArray = Array.from(repsSet).sort();
            
            let html = '';
            repsArray.forEach(repName => {
                // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø¥Ø¯Ø®Ø§Ù„Ø§Øª ÙƒÙ„ Ù…Ù†Ø¯ÙˆØ¨
                const repEntries = Object.values(users).filter(u => u.repName === repName).length;
                
                html += `
                    <div style="background: white; padding: 12px; margin-bottom: 8px; border-radius: 8px; border-right: 3px solid #2ecc71; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; color: #2c3e50;">${repName}</div>
                            <small style="color: #666;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª: ${repEntries}</small>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        };

        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ ÙÙŠ Dropdown
        async function loadRepsDropdown() {
            const usersRef = ref(db, 'users');
            const snapshot = await get(usersRef);
            
            const select = document.getElementById('adminRepSelect');
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ --</option>';
            
            if (!snapshot.exists()) return;
            
            const users = snapshot.val();
            const repsSet = new Set();
            
            Object.values(users).forEach(user => {
                if (user.repName && user.repName.trim() !== '') {
                    repsSet.add(user.repName);
                }
            });
            
            const repsArray = Array.from(repsSet).sort();
            
            repsArray.forEach(repName => {
                const option = document.createElement('option');
                option.value = repName;
                option.textContent = repName;
                select.appendChild(option);
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
        window.loadSelectedRepCounter = async function() {
            const repName = document.getElementById('adminRepSelect').value;
            systemState.selectedAdminRep = repName;
            
            if (!repName) {
                document.getElementById('adminCounter').textContent = '0';
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const counterRef = ref(db, `counters/${repName}`);
            
            const snapshot = await get(counterRef);
            let count = 0;
            
            if (snapshot.exists()) {
                const data = snapshot.val();
                if (data.date === today) {
                    count = data.count || 0;
                }
            }
            
            document.getElementById('adminCounter').textContent = count;
        };

        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
        window.adminIncCounter = async function() {
            const repName = systemState.selectedAdminRep;
            
            if (!repName) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const counterRef = ref(db, `counters/${repName}`);
            
            const snapshot = await get(counterRef);
            let count = 1;
            
            if (snapshot.exists()) {
                const data = snapshot.val();
                if (data.date === today) {
                    count = (data.count || 0) + 1;
                }
            }
            
            await set(counterRef, {
                date: today,
                count: count
            });
            
            document.getElementById('adminCounter').textContent = count;
            alert('âœ… ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
        };

        // Ù†Ù‚ØµØ§Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
        window.adminDecCounter = async function() {
            const repName = systemState.selectedAdminRep;
            
            if (!repName) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const counterRef = ref(db, `counters/${repName}`);
            
            const snapshot = await get(counterRef);
            
            if (!snapshot.exists()) {
                alert('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ø¯Ø§Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨');
                return;
            }
            
            const data = snapshot.val();
            if (data.date !== today) {
                alert('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ø¯Ø§Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…');
                return;
            }
            
            let count = (data.count || 0) - 1;
            if (count < 0) count = 0;
            
            await set(counterRef, {
                date: today,
                count: count
            });
            
            document.getElementById('adminCounter').textContent = count;
            alert('âœ… ØªÙ… Ø¥Ù†Ù‚Ø§Øµ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
        };

        // ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
        window.adminResetCounter = async function() {
            const repName = systemState.selectedAdminRep;
            
            if (!repName) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${repName}ØŸ`)) return;
            
            const today = new Date().toISOString().split('T')[0];
            const counterRef = ref(db, `counters/${repName}`);
            
            await set(counterRef, {
                date: today,
                count: 0
            });
            
            document.getElementById('adminCounter').textContent = '0';
            alert('âœ… ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
        };

        // ØªØµÙÙŠØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª ÙÙ‚Ø·
        window.resetUsersOnly = async function() {
            const password = prompt('âš ï¸ ØªØ­Ø°ÙŠØ±!\n\nØ£Ù†Øª Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù†ØµØ§Ø¨Ø©).\nØ³ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª.\n\nØ£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ£ÙƒÙŠØ¯:');
            
            if (password !== SYSTEM_CONFIG.adminPassword) {
                if (password !== null) {
                    alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
                return;
            }
            
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ù‹Ø§ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§ØªØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) return;
            
            try {
                await remove(ref(db, 'users'));
                await remove(ref(db, 'duplicates'));
                
                alert('âœ… ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                location.reload();
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ±: ' + error.message);
            }
        };

        // ØªØµÙÙŠØ± ÙƒØ§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…
        window.resetAllData = async function() {
            const password = prompt('âš ï¸âš ï¸âš ï¸ ØªØ­Ø°ÙŠØ± Ø´Ø¯ÙŠØ¯! âš ï¸âš ï¸âš ï¸\n\nØ£Ù†Øª Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„:\n- Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª\n- Ø§Ù„Ù†ØµØ§Ø¨Ø©\n- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„\n- Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª\n\nØ£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ£ÙƒÙŠØ¯:');
            
            if (password !== SYSTEM_CONFIG.adminPassword) {
                if (password !== null) {
                    alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
                return;
            }
            
            const confirm1 = confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ 100% Ù…Ù† Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„ØŸ');
            if (!confirm1) return;
            
            const confirm2 = confirm('âš ï¸âš ï¸ ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ: Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡!\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ');
            if (!confirm2) return;
            
            try {
                await remove(ref(db, 'users'));
                await remove(ref(db, 'duplicates'));
                await remove(ref(db, 'messages'));
                await remove(ref(db, 'counters'));
                
                alert('âœ… ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
                location.reload();
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ±: ' + error.message);
            }
        };

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        window.logout = function() {
            systemState = {
                currentUser: null,
                currentPlace: null,
                currentPlaceIdx: null,
                isVerificationMode: false,
                deviceId: systemState.deviceId,
                messagesListener: null,
                unreadMessages: 0,
                currentRepName: "",
                selectedAdminRep: ""
            };
            
            showPage('loginPage');
            
            document.getElementById('loginCode').value = '';
            document.getElementById('repName').value = '';
            document.getElementById('natID').value = '';
        };

        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showAlert(element, message, type = 'info') {
            element.innerHTML = message;
            element.className = `alert alert-${type}`;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function playSound(type) {
            const sound = document.getElementById(`sound${type.charAt(0).toUpperCase() + type.slice(1)}`);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e));
            }
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
        document.getElementById('repName').addEventListener('input', function() {
            systemState.currentRepName = this.value.trim();
            loadEntryCounter();
        });
    </script>
</body>
</html>
