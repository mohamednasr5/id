<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„Ø¬Ø§Ù† - Firebase</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{font-family:Cairo;background:#f5f6fa}
.committee-card{background:#fff;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 3px 10px rgba(0,0,0,.08)}
.delegate{background:#f1f2f6;border-radius:8px;padding:10px;margin-bottom:8px}
.phone{direction:ltr;font-weight:bold}
</style>
</head>

<body class="container py-4">

<h3 class="mb-4"><i class="fa fa-users"></i> Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„Ø¬Ø§Ù† â€“ Firebase</h3>

<div id="committeesContainer" class="row"></div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

/* ğŸ”¥ Firebase Config */
const firebaseConfig = {
 apiKey: "AIzaSyDSeCdQEQ_GlPh2bHN_g1zY0uT5itZHjxg",
 authDomain: "mandowb-9ce4d.firebaseapp.com",
 projectId: "mandowb-9ce4d",
 storageBucket: "mandowb-9ce4d.firebasestorage.app",
 messagingSenderId: "19347263922",
 appId: "1:19347263922:web:970047c58c5c250f7194ab"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ========= Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø¬Ø§Ù† 1 â†’ 60 Ø£ÙˆÙ„ Ù…Ø±Ø© ========= */
for(let i=1;i<=60;i++){
  set(ref(db,'committees/'+i+'/id'),i);
}

/* ========= Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø¬Ø§Ù† ========= */
const container = document.getElementById("committeesContainer");

onValue(ref(db,'committees'), snap=>{
 container.innerHTML='';
 snap.forEach(comm=>{
   const id = comm.key;
   const delegates = comm.child('delegates').val() || {};
   
   const col = document.createElement('div');
   col.className="col-md-4";

   col.innerHTML = `
   <div class="committee-card">
     <h5>Ù„Ø¬Ù†Ø© Ø±Ù‚Ù… ${id}</h5>
     <div id="list-${id}"></div>

     <button class="btn btn-sm btn-success w-100 mt-2"
       onclick="addDelegate(${id})">
       <i class="fa fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨
     </button>
   </div>`;
   
   container.appendChild(col);

   const list = col.querySelector(`#list-${id}`);
   Object.entries(delegates).forEach(([key,d])=>{
     list.innerHTML += `
     <div class="delegate">
       <div><b>${d.name}</b></div>
       <div class="phone">${d.phone}</div>
       <div class="mt-1">
         <a class="btn btn-sm btn-primary" href="tel:${d.phone}"><i class="fa fa-phone"></i></a>
         <a class="btn btn-sm btn-success" href="https://wa.me/2${d.phone}" target="_blank"><i class="fab fa-whatsapp"></i></a>
         <button class="btn btn-sm btn-danger" onclick="removeDelegate(${id},'${key}')">
           <i class="fa fa-trash"></i>
         </button>
       </div>
     </div>`;
   });
 });
});

/* ========= Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨ ========= */
window.addDelegate = function(id){
 const name = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨");
 if(!name) return;
 const phone = prompt("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
 if(!phone) return;

 push(ref(db,'committees/'+id+'/delegates'),{
   name, phone
 });
};

/* ========= Ø­Ø°Ù Ù…Ù†Ø¯ÙˆØ¨ ========= */
window.removeDelegate = function(id,key){
 if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ØŸ")){
   remove(ref(db,'committees/'+id+'/delegates/'+key));
 }
};

</script>
</body>
</html>
