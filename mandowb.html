<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ù„Ø¬Ø§Ù† Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
            font-family: 'Cairo', sans-serif;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,.08);
        }
        .icon-btn {
            font-size: 20px;
            margin: 0 5px;
        }
        .whatsapp { color: #25D366; }
        .call { color: #0d6efd; }
    </style>
</head>
<body>

<div class="container my-5">
    <h3 class="text-center mb-4">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ù„Ø¬Ø§Ù† Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</h3>

    <!-- Ø¥Ø¶Ø§ÙØ© Ù„Ø¬Ù†Ø© -->
    <div class="card mb-4 p-3">
        <h5>â• Ø¥Ø¶Ø§ÙØ© Ù„Ø¬Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø©</h5>
        <div class="row g-2">
            <div class="col-md-8">
                <input id="committeeNumber" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©">
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary w-100" onclick="addCommittee()">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
        </div>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø¬Ø§Ù† -->
    <div id="committeesContainer"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import {
    getFirestore, collection, addDoc, getDocs,
    doc, deleteDoc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDSeCdQEQ_GlPh2bHN_g1zY0uT5itZHjxg",
    authDomain: "mandowb-9ce4d.firebaseapp.com",
    projectId: "mandowb-9ce4d",
    storageBucket: "mandowb-9ce4d.firebasestorage.app",
    messagingSenderId: "19347263922",
    appId: "1:19347263922:web:970047c58c5c250f7194ab",
    measurementId: "G-JE6R74Q9Q7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Ø¥Ø¶Ø§ÙØ© Ù„Ø¬Ù†Ø©
window.addCommittee = async () => {
    const number = committeeNumber.value.trim();
    if (!number) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø©");

    await addDoc(collection(db, "committees"), {
        committeeNumber: number
    });

    committeeNumber.value = "";
    loadCommittees();
};

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¬Ø§Ù†
async function loadCommittees() {
    const container = document.getElementById("committeesContainer");
    container.innerHTML = "";

    const snapshot = await getDocs(collection(db, "committees"));
    snapshot.forEach(async (docSnap) => {
        const data = docSnap.data();
        const committeeId = docSnap.id;

        const card = document.createElement("div");
        card.className = "card mb-3 p-3";

        card.innerHTML = `
            <h5>ğŸŸ¦ Ù„Ø¬Ù†Ø© Ø±Ù‚Ù… ${data.committeeNumber}</h5>

            <div class="row g-2 mb-2">
                <div class="col-md-4">
                    <input class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨" id="name-${committeeId}">
                </div>
                <div class="col-md-4">
                    <input class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" id="phone-${committeeId}">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-success w-100" onclick="addDelegate('${committeeId}')">
                        Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨
                    </button>
                </div>
            </div>

            <ul class="list-group" id="delegates-${committeeId}"></ul>
        `;

        container.appendChild(card);
        loadDelegates(committeeId);
    });
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨
window.addDelegate = async (committeeId) => {
    const name = document.getElementById(`name-${committeeId}`).value.trim();
    const phone = document.getElementById(`phone-${committeeId}`).value.trim();

    if (!name || !phone) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");

    await addDoc(collection(db, "committees", committeeId, "delegates"), {
        name,
        phone
    });

    document.getElementById(`name-${committeeId}`).value = "";
    document.getElementById(`phone-${committeeId}`).value = "";

    loadDelegates(committeeId);
};

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†
async function loadDelegates(committeeId) {
    const list = document.getElementById(`delegates-${committeeId}`);
    list.innerHTML = "";

    const snapshot = await getDocs(collection(db, "committees", committeeId, "delegates"));
    snapshot.forEach(docSnap => {
        const d = docSnap.data();
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";

        li.innerHTML = `
            <div>
                <strong>${d.name}</strong><br>
                ${d.phone}
            </div>
            <div>
                <a href="tel:${d.phone}" class="icon-btn call">
                    <i class="fa-solid fa-phone"></i>
                </a>
                <a href="https://wa.me/${d.phone}" target="_blank" class="icon-btn whatsapp">
                    <i class="fa-brands fa-whatsapp"></i>
                </a>
                <button class="btn btn-sm btn-danger" onclick="deleteDelegate('${committeeId}','${docSnap.id}')">
                    Ø­Ø°Ù
                </button>
            </div>
        `;

        list.appendChild(li);
    });
}

// Ø­Ø°Ù Ù…Ù†Ø¯ÙˆØ¨
window.deleteDelegate = async (committeeId, delegateId) => {
    if (!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) return;
    await deleteDoc(doc(db, "committees", committeeId, "delegates", delegateId));
    loadDelegates(committeeId);
};

loadCommittees();
</script>

</body>
</html>
