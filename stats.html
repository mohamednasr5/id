<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
Â  <meta charset="UTF-8">
Â  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­ÙŠØ©</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap">
Â  <style>
Â  Â  :root {
Â  Â  Â  --primary-color: #0072ff;
Â  Â  Â  --secondary-color: #00c6ff;
Â  Â  Â  --bg-gradient: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
Â  Â  Â  --glass-bg: rgba(255, 255, 255, 0.95);
Â  Â  Â  --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
Â  Â  Â  --text-color: #2d3436;
Â  Â  Â  --danger-color: #ff4757;
Â  Â  Â  --success-color: #2ecc71;
Â  Â  }

Â  Â  * { box-sizing: border-box; }

Â  Â  body {
Â  Â  Â  font-family: 'Cairo', sans-serif;
Â  Â  Â  margin: 0; padding: 20px;
Â  Â  Â  min-height: 100vh;
Â  Â  Â  background: var(--bg-gradient);
Â  Â  Â  background-size: 400% 400%;
Â  Â  Â  animation: gradientBG 15s ease infinite;
Â  Â  Â  color: var(--text-color);
Â  Â  }

Â  Â  @keyframes gradientBG {
Â  Â  Â  0% { background-position: 0% 50%; }
Â  Â  Â  50% { background-position: 100% 50%; }
Â  Â  Â  100% { background-position: 0% 50%; }
Â  Â  }

Â  Â  /* ÙƒØ±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© */
Â  Â  .circles {
Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  overflow: hidden; z-index: -1; pointer-events: none;
Â  Â  }
Â  Â  .circles li {
Â  Â  Â  position: absolute; display: block; list-style: none;
Â  Â  Â  width: 20px; height: 20px; background: rgba(255, 255, 255, 0.2);
Â  Â  Â  animation: animate 25s linear infinite; bottom: -150px; border-radius: 50%;
Â  Â  }
Â  Â  .circles li:nth-child(1){ left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
Â  Â  .circles li:nth-child(2){ left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
Â  Â  .circles li:nth-child(3){ left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
Â  Â  .circles li:nth-child(4){ left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
Â  Â  .circles li:nth-child(5){ left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
Â  Â  @keyframes animate {
Â  Â  Â  0%{ transform: translateY(0) rotate(0deg); opacity: 1; border-radius: 0; }
Â  Â  Â  100%{ transform: translateY(-1000px) rotate(720deg); opacity: 0; border-radius: 50%; }
Â  Â  }

Â  Â  /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
Â  Â  #loginScreen {
Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  background: rgba(0,0,0,0.6); backdrop-filter: blur(15px);
Â  Â  Â  z-index: 9999; display: flex; justify-content: center; align-items: center;
Â  Â  }
Â  Â  .login-box {
Â  Â  Â  background: white; padding: 40px; border-radius: 20px;
Â  Â  Â  text-align: center; width: 90%; max-width: 400px;
Â  Â  Â  box-shadow: 0 20px 50px rgba(0,0,0,0.3);
Â  Â  }
Â  Â  .login-box input {
Â  Â  Â  width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #eee;
Â  Â  Â  border-radius: 10px; font-size: 18px; font-family: 'Cairo', sans-serif;
Â  Â  Â  text-align: center; transition: 0.3s;
Â  Â  }
Â  Â  .login-box input:focus { border-color: var(--primary-color); outline: none; }
Â  Â  .login-btn {
Â  Â  Â  background: var(--primary-color); color: white; border: none;
Â  Â  Â  padding: 12px 40px; border-radius: 50px; font-size: 18px;
Â  Â  Â  font-family: 'Cairo', sans-serif; cursor: pointer; transition: 0.3s;
Â  Â  }
Â  Â  .login-btn:hover { transform: scale(1.05); }

Â  Â  /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
Â  Â  .container {
Â  Â  Â  max-width: 1300px; margin: 0 auto;
Â  Â  Â  background: var(--glass-bg); backdrop-filter: blur(10px);
Â  Â  Â  -webkit-backdrop-filter: blur(10px); border-radius: 20px;
Â  Â  Â  box-shadow: var(--glass-shadow); padding: 30px;
Â  Â  Â  opacity: 0; transform: translateY(20px); transition: 0.8s ease; display: none;
Â  Â  }
Â  Â  .container.visible { opacity: 1; transform: translateY(0); display: block; }

Â  Â  .header-row {
Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  margin-bottom: 20px; flex-wrap: wrap; gap: 10px;
Â  Â  }
Â  Â Â 
Â  Â  .controls { display: flex; gap: 10px; flex-wrap: wrap; }

Â  Â  h2 { margin: 0; color: var(--primary-color); font-weight: 700; font-size: 1.5rem; }

Â  Â  .btn {
Â  Â  Â  padding: 8px 20px; border-radius: 50px; border: none; font-size: 14px;
Â  Â  Â  cursor: pointer; transition: 0.3s; color: white;
Â  Â  Â  font-family: 'Cairo', sans-serif; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
Â  Â  Â  display: inline-flex; align-items: center; gap: 5px;
Â  Â  }
Â  Â  .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
Â  Â Â 
Â  Â  .btn-back { background: #7f8c8d; }
Â  Â  .btn-print { background: var(--primary-color); }
Â  Â  .btn-excel { background: var(--success-color); }
Â  Â  .btn-reset { background: var(--danger-color); }

Â  Â  /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
Â  Â  .table-wrapper { overflow-x: auto; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

Â  Â  table { width: 100%; border-collapse: separate; border-spacing: 0; background: #fff; min-width: 800px; }
Â  Â  th, td { padding: 15px; text-align: center; border-bottom: 1px solid #eee; }
Â  Â  th {
Â  Â  Â  background: rgba(0, 114, 255, 0.1); color: var(--primary-color);
Â  Â  Â  font-weight: 700; white-space: nowrap; position: sticky; top: 0;
Â  Â  Â  border-bottom: 2px solid var(--primary-color);
Â  Â  }
Â  Â  tr:last-child td { border-bottom: none; }
Â  Â  tr:hover td { background: rgba(0, 114, 255, 0.05); }

Â  Â  /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */
Â  Â  .rep-tag {
Â  Â  Â  Â  cursor: pointer; padding: 4px 8px; border-radius: 8px; transition: 0.2s;
Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  Â  margin-bottom: 4px; border: 1px solid transparent;
Â  Â  }
Â  Â  .rep-tag:hover { background: rgba(0, 114, 255, 0.1); border-color: var(--secondary-color); }

Â  Â  .statok {
Â  Â  Â  color: #2ecc71; font-weight: bold; background: rgba(46, 204, 113, 0.1);
Â  Â  Â  padding: 2px 8px; border-radius: 12px; font-size: 0.9em;
Â  Â  }
Â  Â Â 
Â  Â  /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ù„ÙŠØ© Ø§Ù„Ù†ØµØ§Ø¨Ø© */
Â  Â  .nassaba-cell {
Â  Â  Â  Â  color: #e74c3c;
Â  Â  Â  Â  font-weight: 900;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  transition: 0.2s;
Â  Â  Â  Â  text-decoration: underline;
Â  Â  Â  Â  text-underline-offset: 4px;
Â  Â  }
Â  Â  .nassaba-cell:hover {
Â  Â  Â  Â  background-color: #ffecec;
Â  Â  Â  Â  transform: scale(1.1);
Â  Â  }
Â  Â  .zero-nassaba { color: #bbb; text-decoration: none; cursor: default; }

Â  Â  /* Modals */
Â  Â  .modal {
Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  background: rgba(0,0,0,0.8); z-index: 10000; display: none;
Â  Â  Â  Â  justify-content: center; align-items: center; backdrop-filter: blur(8px);
Â  Â  }
Â  Â  .modal-content {
Â  Â  Â  Â  background: white; padding: 40px; border-radius: 25px; text-align: center;
Â  Â  Â  Â  position: relative; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  Â  Â  width: 90%; max-width: 450px; max-height: 80vh; overflow-y: auto;
Â  Â  }
Â  Â  @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
Â  Â Â 
Â  Â  .close-modal {
Â  Â  Â  Â  position: absolute; top: 15px; left: 15px; font-size: 24px; cursor: pointer;
Â  Â  Â  Â  color: #aaa; width: 30px; height: 30px; line-height: 30px;
Â  Â  Â  Â  background: #eee; border-radius: 50%;
Â  Â  }
Â  Â Â 
Â  Â  /* Ø³ØªØ§ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØµØ§Ø¨Ø© */
Â  Â  .nassaba-list {
Â  Â  Â  Â  list-style: none; padding: 0; margin-top: 15px; text-align: right;
Â  Â  }
Â  Â  .nassaba-list li {
Â  Â  Â  Â  background: #fff5f5; border: 1px solid #ffcccc; color: #c0392b;
Â  Â  Â  Â  padding: 10px; margin-bottom: 8px; border-radius: 8px;
Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  }
Â  Â Â 
Â  Â  /* Ø²Ø± Ø§Ù„Ù†Ø³Ø® */
Â  Â  .copy-btn {
Â  Â  Â  Â  background: #eee; border: 1px solid #ccc; padding: 4px 10px;
Â  Â  Â  Â  border-radius: 4px; cursor: pointer; font-size: 0.85rem;
Â  Â  Â  Â  font-family: 'Cairo', sans-serif; margin-right: 8px;
Â  Â  Â  Â  transition: 0.2s; outline: none;
Â  Â  }
Â  Â  .copy-btn:hover { background: #ddd; }
Â  Â  .copy-btn.copied { background: #2ecc71; color: white; border-color: #2ecc71; }

Â  Â  .loader {
Â  Â  Â  border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
Â  Â  Â  border-radius: 50%; width: 40px; height: 40px;
Â  Â  Â  animation: spin 1s linear infinite; margin: 50px auto;
Â  Â  }
Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

Â  Â  @media print {
Â  Â  Â  Â  body { background: white; animation: none; padding: 0; color: black; }
Â  Â  Â  Â  .circles, .controls, .btn_back, #loginScreen, .btn, .modal { display: none !important; }
Â  Â  Â  Â  .container { box-shadow: none; margin: 0; width: 100%; max-width: 100%; padding: 10px; opacity: 1; transform: none; }
Â  Â  Â  Â  .table-wrapper { overflow: visible; box-shadow: none; }
Â  Â  Â  Â  table { min-width: 100%; border: 1px solid #000; }
Â  Â  Â  Â  th { background-color: #eee !important; color: #000 !important; border: 1px solid #000; }
Â  Â  Â  Â  td { border: 1px solid #000; color: #000; }
Â  Â  }
Â  </style>
</head>
<body>

Â  <div id="loginScreen">
Â  Â  <div class="login-box">
Â  Â  Â  <h2 style="margin-bottom:20px;">Ù…Ø­Ù…ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</h2>
Â  Â  Â  <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
Â  Â  Â  <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§">
Â  Â  Â  <button class="login-btn" onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
Â  Â  Â  <p id="errorMsg" style="color:red; display:none; margin-top:10px;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©</p>
Â  Â  </div>
Â  </div>

Â  <div id="repModal" class="modal">
Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  <div class="close-modal" onclick="closeModal('repModal')">&times;</div>
Â  Â  Â  Â  Â  <h3 style="color:var(--primary-color)" id="modalRepName">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h3>
Â  Â  Â  Â  Â  <p>Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ø¯Ø®Ù„</p>
Â  Â  Â  Â  Â  <div style="font-size:6rem; font-weight:800; color:var(--primary-color);" id="modalRepCount">0</div>
Â  Â  Â  Â  Â  <p style="color:#888; margin:0;">Ù†Ø§Ø®Ø¨</p>
Â  Â  Â  </div>
Â  </div>

Â  <div id="nassabaModal" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <div class="close-modal" onclick="closeModal('nassabaModal')">&times;</div>
Â  Â  Â  Â  <h3 style="color:var(--danger-color)">âš ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØµØ§Ø¨Ø©</h3>
Â  Â  Â  Â  <p>Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙŠ Ø­Ø§ÙˆÙ„Øª Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙŠ:</p>
Â  Â  Â  Â  <h4 id="nassabaPlaceName" style="color:#333;"></h4>
Â  Â  Â  Â  <ul id="nassabaListContainer" class="nassaba-list">
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  </div>
</div>

Â  <ul class="circles">
Â  Â  <li></li><li></li><li></li><li></li><li></li>
Â  Â  <li></li><li></li><li></li><li></li><li></li>
Â  </ul>

Â  <div class="container">
Â  Â  <div class="header-row">
Â  Â  Â  <h2>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± ğŸ”´)</h2>
Â  Â  Â  <div class="controls">
Â  Â  Â  Â  <button class="btn btn-print" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© A4</button>
Â  Â  Â  Â  <button class="btn btn-excel" onclick="exportToExcel()">ØªØµØ¯ÙŠØ± Excel</button>
Â  Â  Â  Â  <button class="btn btn-reset" onclick="resetData()">ØªØµÙÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
Â  Â  Â  Â  <button class="btn btn-back" onclick="location='DelegateApp_Pro.html'">Ø¹ÙˆØ¯Ø©</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="table-wrapper">
Â  Â  Â  <table id="statTable">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <th>Ù…</th>
Â  Â  Â  Â  Â  Â  <th>Ø§Ù„Ù…ÙƒØ§Ù†</th>
Â  Â  Â  Â  Â  Â  <th>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ</th>
Â  Â  Â  Â  Â  Â  <th style="color:var(--danger-color);">Ù†ØµØ§Ø¨Ø© âš ï¸</th>
Â  Â  Â  Â  Â  Â  <th>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</th>
Â  Â  Â  Â  Â  Â  <th>Ø£ÙˆÙ„ Ø¥Ø¯Ø®Ø§Ù„</th>
Â  Â  Â  Â  Â  Â  <th>Ø¢Ø®Ø± Ø¥Ø¯Ø®Ø§Ù„</th>
Â  Â  Â  Â  Â  Â  <th>Ø§Ù„Ù…Ø¯Ø©</th>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody id="tbody">
Â  Â  Â  Â  Â  <tr><td colspan="8"><div class="loader"></div></td></tr>
Â  Â  Â  Â  </tbody>
Â  Â  Â  </table>
Â  Â  </div>
Â  </div>
Â Â 
Â  <script type="module">
Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
Â  Â  import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

Â  Â  const firebaseConfig = {
Â  Â  Â  apiKey: "AIzaSyAxnIxtFeAOjYjCIrU5cwYVteuQ18K8Kjc",
Â  Â  Â  authDomain: "idmanazla.firebaseapp.com",
Â  Â  Â  databaseURL: "https://idmanazla-default-rtdb.europe-west1.firebasedatabase.app",
Â  Â  Â  projectId: "idmanazla",
Â  Â  Â  storageBucket: "idmanazla.firebasestorage.app",
Â  Â  Â  messagingSenderId: "408446131276",
Â  Â  Â  appId: "1:408446131276:web:976ae54181b5398de5a8e9",
Â  Â  Â  measurementId: "G-9YSW9HNYTG"
Â  Â  };
Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  const db = getDatabase(app);

Â  Â  // Ù…ØµÙÙˆÙØ© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ù„Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù€ Firebase (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ù€ DB)
    // Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ù…Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ Ù‡ÙŠ Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·ØŒ 
    // Ù„ÙƒÙ† Ù„Ø±Ø¨Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ØŒ Ù†Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø«Ù„ Ø§Ù„Ù€ Key ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
Â  Â  const places = [
      "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 1",
      "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 2",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ Ø´Ø§Ø±Ø¹ Ø§Ù„ÙƒØ§Ø¨ØªÙ†",
      "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø§Ù„ Ø´Ù„Ø¨ÙŠØ§ÙŠØ©",
      "Ù…ØµÙ†Ø¹ Ø§Ù„Ø¨ØµÙ„",
      "Ø§Ù„ÙƒÙØ± 1",
      "Ø§Ù„ÙƒÙØ± 2 ØªØ­Øª Ø§Ù„Ø³ÙƒØ©",
      "Ø³ÙˆÙ‚ Ø§Ù„Ø¬Ù…Ù„Ø©",
      "Ø§Ù„ÙØ¯Ø§Ø¡ 1", // ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† "Ø§Ù„ÙØ¯Ø§Ø¡"
      "Ø§Ù„ÙØ¯Ø§Ø¡ 2", // Ø§Ø³Ù… Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¶Ø§ÙØ© "Ø§Ù„ÙØ¯Ø§Ø¡ 2"
      "Ø§Ù„Ø­Ù…Ø²Ø§ÙˆÙŠ",
      "Ø§Ù„Ø¬Ø±Ù† 1",
      "Ø§Ù„Ø¬Ø±Ù† 2",
      "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…", // ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† "Ø§Ù„Ø¨Ø± Ø§Ù„ØªØ§Ù†ÙŠ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…"
      "Ø­ÙŠ Ø§Ù„Ø£Ø¹Ø¬Ø§Ù…", // ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† "Ø­ÙŠ Ø§Ù„Ø§Ø¹Ø¬Ø§Ù…"
      "Ø§Ù„Ø¹Ø²Ø¨Ø© Ù…Ù†Ø´ÙŠØ© Ù†Ø§ØµØ±",
      "Ø§Ù„Ø·ÙˆÙŠÙ„",
      "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ 2 Ø§Ù„Ù‡Ø§ÙˆÙŠØ³", // ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† "Ø§Ù„Ø¨Ø± Ø§Ù„ØªØ§Ù†ÙŠ 2 Ø§Ù„Ù‡Ø§ÙˆÙŠØ³"
      "Ø§Ù„ÙÙ‚Ø§Ø¹ÙŠ",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 2",
      "Ø­ÙŠ Ø§Ù„Ø¬Ø¨Ø§Ù†Ø©",
      "Ø§Ù„ÙƒÙØ± 3 Ø¨Ø¬ÙˆØ§Ø± Ù…Ù„Ø¹Ø¨ Ø¨Ø±Ø´Ù„ÙˆÙ†Ø©",
      "Ø£Ø¨Ùˆ Ø±Ø´Ø§Ø¯ Ù…Ù‚Ù‡Ù‰ Ø£Ø¨Ùˆ Ø³Ù„ÙŠÙ…Ø§Ù†", // ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† "Ù…Ù‚Ù‡ÙŠ Ø£Ø¨Ùˆ Ø³Ù„ÙŠÙ…Ø§Ù†"
      "Ø­ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 3" // Ø§Ø³Ù… Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¶Ø§ÙØ© "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 3"
    ];

Â  Â  // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù„Ø­Ø¸ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
Â  Â  window.startListening = function() {
Â  Â  Â  const dbRef = ref(db);
Â  Â  Â Â 
Â  Â  Â  onValue(dbRef, (snapshot) => {
Â  Â  Â  Â  const data = snapshot.val() || {};
Â  Â  Â  Â  const users = data.users || {};
Â  Â  Â  Â  const duplicates = data.duplicates || {};

Â  Â  Â  Â  let perPlace = {};
Â  Â  Â  Â Â 
Â  Â  Â  Â  for (let id in users) {
Â  Â  Â  Â  Â  let u = users[id];
Â  Â  Â  Â  Â  const key = u.place;
Â  Â  Â  Â  Â  if (!perPlace[key]) {
Â  Â  Â  Â  Â  Â  perPlace[key] = {count:0, nassabaList:[], reps:{}, times:[]};
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  perPlace[key].count++;
Â  Â  Â  Â  Â  if (!perPlace[key].reps[u.repName]) perPlace[key].reps[u.repName]=[];
Â  Â  Â  Â  Â  perPlace[key].reps[u.repName].push(u.time);
Â  Â  Â  Â  Â  perPlace[key].times.push(u.time);
Â  Â  Â  Â  }

Â  Â  Â  Â  for (let pushId in duplicates) {
Â  Â  Â  Â  Â  Â  let d = duplicates[pushId];
Â  Â  Â  Â  Â  Â  const key = d.attemptPlace;
Â  Â  Â  Â  Â  Â  if (!perPlace[key]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â perPlace[key] = {count:0, nassabaList:[], reps:{}, times:[]};
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  perPlace[key].nassabaList.push({
Â  Â  Â  Â  Â  Â  Â  Â  id: d.duplicatedID,
Â  Â  Â  Â  Â  Â  Â  Â  by: d.attemptByRep,
Â  Â  Â  Â  Â  Â  Â  Â  time: d.timestamp
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  window.allStats = perPlace;
Â  Â  Â  Â  renderTable(perPlace);
Â  Â  Â  }, (error) => {
Â  Â  Â  Â  document.getElementById('tbody').innerHTML = `<tr><td colspan="8" style="color:red">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}</td></tr>`;
Â  Â  Â  });
Â  Â  };

Â  Â  function renderTable(perPlace) {
Â  Â  Â  Â  // Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨)
Â  Â  Â  Â  const displayPlaces = [
          "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 1 - ÙƒØ±ÙŠÙ… Ø§Ù„Ù…Ø±ÙˆØ±",
          "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 2 - Ø´Ø±ÙŠÙ Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµØ­ÙŠ",
          "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ Ø´Ø§Ø±Ø¹ Ø§Ù„ÙƒØ§Ø¨ØªÙ† - Ø´Ø±ÙŠÙ Ø§Ù„Ø¹Ø²Ø§Ø²ÙŠ",
          "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø§Ù„ Ø´Ù„Ø¨ÙŠØ§ÙŠØ© - Ø£Ø´Ø±Ù Ø§Ù„Ø£Ø¨Ø§ØµÙŠØ±ÙŠ",
          "Ù…ØµÙ†Ø¹ Ø§Ù„Ø¨ØµÙ„ - ÙØ¤Ø§Ø¯ Ø­Ø§Ù„",
          "Ø§Ù„ÙƒÙØ± 1 - Ø¹Ù„ÙŠ Ø´Ø·Ø§",
          "Ø§Ù„ÙƒÙØ± 2 ØªØ­Øª Ø§Ù„Ø³ÙƒØ© - Ø±Ø§Ø¨Ø­ Ø´Ø·Ø§",
          "Ø³ÙˆÙ‚ Ø§Ù„Ø¬Ù…Ù„Ø© - Ø§Ù„Ø³Ø¹ÙŠØ¯ Ø´Ø·Ø§",
          "Ø§Ù„ÙØ¯Ø§Ø¡ 1 - Ø¹Ù…Ø± Ø§Ù„ÙƒÙŠØ§Ù„",
          "Ø§Ù„ÙØ¯Ø§Ø¡ 2 - Ø­Ù…Ø§Ø¯Ù‡ Ø§Ù„ÙƒÙŠØ§Ù„",
          "Ø§Ù„Ø­Ù…Ø²Ø§ÙˆÙŠ - Ø­Ù…Ø§Ø¯Ù‡ Ø§Ù„Ø´Ø±ÙŠ",
          "Ø§Ù„Ø¬Ø±Ù† 1 - Ø¨ÙˆØ¬ÙŠ Ø§Ù„Ø¨Ø±Ø¹ÙŠ",
          "Ø§Ù„Ø¬Ø±Ù† 2 - Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… ÙÙ‡ÙŠØ¯",
          "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù… - ÙŠØ­ÙŠÙ‰ Ø­Ø¨Ù‚",
          "Ø­ÙŠ Ø§Ù„Ø£Ø¹Ø¬Ø§Ù… - Ù…Ø­Ù…Ø¯ Ø£Ø¨Ùˆ Ø±Ø¬Ø¨",
          "Ø§Ù„Ø¹Ø²Ø¨Ø© Ù…Ù†Ø´ÙŠØ© Ù†Ø§ØµØ± - Ø£ÙŠÙ…Ù† Ù‚Ù†Ø¯ÙŠÙ„",
          "Ø§Ù„Ø·ÙˆÙŠÙ„ - Ø£Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø¸ÙŠÙ…",
          "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ 2 Ø§Ù„Ù‡Ø§ÙˆÙŠØ³ - Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø¬ÙŠØ¯",
          "Ø§Ù„ÙÙ‚Ø§Ø¹ÙŠ - Ù…Ø­Ù…Ø¯ Ø­Ø¨ÙŠØ¨",
          "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 2 - Ø§Ù„Ø³ÙŠØ¯ Ø­Ø±Ø§Ø²",
          "Ø­ÙŠ Ø§Ù„Ø¬Ø¨Ø§Ù†Ø© - Ø³Ø¹Ø¯ Ø§Ù„Ø´Ù„ÙˆØ¯ÙŠ",
          "Ø§Ù„ÙƒÙØ± 3 Ø¨Ø¬ÙˆØ§Ø± Ù…Ù„Ø¹Ø¨ Ø¨Ø±Ø´Ù„ÙˆÙ†Ø© - Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©",
          "Ø£Ø¨Ùˆ Ø±Ø´Ø§Ø¯ Ù…Ù‚Ù‡Ù‰ Ø£Ø¨Ùˆ Ø³Ù„ÙŠÙ…Ø§Ù† - Ù…Ø­Ù…Ø¯ Ø±Ø´Ø§Ø¯",
          "Ø­ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ - Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹ÙŠØ¯",
          "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 3 - Ù…Ù†ØµÙˆØ± Ø§Ù„Ø¨Ø¯Ø±ÙŠ"
        ];
        
        // Ù…ØµÙÙˆÙØ© Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù€ Firebase Ù„Ø±Ø¨Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const firebaseKeys = [
          "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 1",
          "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 2",
          "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ Ø´Ø§Ø±Ø¹ Ø§Ù„ÙƒØ§Ø¨ØªÙ†",
          "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø§Ù„ Ø´Ù„Ø¨ÙŠØ§ÙŠØ©",
          "Ù…ØµÙ†Ø¹ Ø§Ù„Ø¨ØµÙ„",
          "Ø§Ù„ÙƒÙØ± 1",
          "Ø§Ù„ÙƒÙØ± 2 ØªØ­Øª Ø§Ù„Ø³ÙƒØ©",
          "Ø³ÙˆÙ‚ Ø§Ù„Ø¬Ù…Ù„Ø©",
          "Ø§Ù„ÙØ¯Ø§Ø¡ 1",
          "Ø§Ù„ÙØ¯Ø§Ø¡ 2",
          "Ø§Ù„Ø­Ù…Ø²Ø§ÙˆÙŠ",
          "Ø§Ù„Ø¬Ø±Ù† 1",
          "Ø§Ù„Ø¬Ø±Ù† 2",
          "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…",
          "Ø­ÙŠ Ø§Ù„Ø£Ø¹Ø¬Ø§Ù…",
          "Ø§Ù„Ø¹Ø²Ø¨Ø© Ù…Ù†Ø´ÙŠØ© Ù†Ø§ØµØ±",
          "Ø§Ù„Ø·ÙˆÙŠÙ„",
          "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ 2 Ø§Ù„Ù‡Ø§ÙˆÙŠØ³",
          "Ø§Ù„ÙÙ‚Ø§Ø¹ÙŠ",
          "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 2",
          "Ø­ÙŠ Ø§Ù„Ø¬Ø¨Ø§Ù†Ø©",
          "Ø§Ù„ÙƒÙØ± 3 Ø¨Ø¬ÙˆØ§Ø± Ù…Ù„Ø¹Ø¨ Ø¨Ø±Ø´Ù„ÙˆÙ†Ø©",
          "Ø£Ø¨Ùˆ Ø±Ø´Ø§Ø¯ Ù…Ù‚Ù‡Ù‰ Ø£Ø¨Ùˆ Ø³Ù„ÙŠÙ…Ø§Ù†",
          "Ø­ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡",
          "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 3"
        ];

Â  Â  Â  Â  let tbody = '';
Â  Â  Â  Â  // Ù†Ø³ØªØ®Ø¯Ù… firebaseKeys Ù„Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ùˆ displayPlaces Ù„Ù„Ø¹Ø±Ø¶
Â  Â  Â  Â  firebaseKeys.forEach((key, i) => {
Â  Â  Â  Â  Â  let p = perPlace[key] || {count:0, nassabaList:[], reps:{}, times:[]};
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  let minTime = p.times.length ? new Date(Math.min(...p.times.map(t=>new Date(t)))) : '-';
Â  Â  Â  Â  Â  let maxTime = p.times.length ? new Date(Math.max(...p.times.map(t=>new Date(t)))) : '-';
Â  Â  Â  Â  Â  let diff = (minTime!='-' && maxTime!='-') ? ((maxTime-minTime)/60000) : null;
Â  Â  Â  Â  Â  let duration = (diff!==null)? `${Math.floor(diff/60)} Ø³ ${Math.floor(diff%60).toString().padStart(2,'0')} Ø¯`:'-';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  let repDetails = Object.entries(p.reps)
Â  Â  Â  Â  Â  Â  .map(([k,v]) => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="rep-tag" onclick="showRepStat('${k}', ${v.length})">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${k}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="statok">${v.length}</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `).join("");

Â  Â  Â  Â  Â  let nassabaCount = p.nassabaList.length;
Â  Â  Â  Â  Â  let nassabaClass = nassabaCount > 0 ? 'nassaba-cell' : 'zero-nassaba';
Â  Â  Â  Â  Â  // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ key Ù„Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
Â  Â  Â  Â  Â  let nassabaAction = nassabaCount > 0 ? `onclick="showNassabaDetails('${key}')"` : '';

Â  Â  Â  Â  Â  tbody += `<tr>
Â  Â  Â  Â  Â  Â  <td><b>${i + 1}</b></td>Â 
Â  Â  Â  Â  Â  Â  <td style="font-weight:bold; color:var(--primary-color)">${displayPlaces[i]}</td>
Â  Â  Â  Â  Â  Â  <td><span style="font-size:1.1em; font-weight:bold;">${p.count}</span></td>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="${nassabaClass}" ${nassabaAction}>${nassabaCount}</span>
Â  Â  Â  Â  Â  Â  </td>

Â  Â  Â  Â  Â  Â  <td style="text-align:right; direction:rtl;">${repDetails||'-'}</td>
Â  Â  Â  Â  Â  Â  <td dir="ltr">${minTime!='-' ? minTime.toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'}) : '-'}</td>
Â  Â  Â  Â  Â  Â  <td dir="ltr">${maxTime!='-' ? maxTime.toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'}) : '-'}</td>
Â  Â  Â  Â  Â  Â  <td>${duration}</td>
Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById('tbody').innerHTML = tbody;
Â  Â  }

Â  Â  window.resetData = async function() {
Â  Â  Â  Â  if(confirm("ØªØ­Ø°ÙŠØ± Ù‡Ø§Ù…:\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù†ØµØ§Ø¨Ø©ØŸ")) {
Â  Â  Â  Â  Â  Â  const userPass = prompt("Ù„Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ (251988):");
Â  Â  Â  Â  Â  Â  if(userPass === "251988"){
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await remove(ref(db));Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.");
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + e.message);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  };
Â  </script>

Â  <script>
    // Ù…ØµÙÙˆÙØ© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
    const places = [
      "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 1 - ÙƒØ±ÙŠÙ… Ø§Ù„Ù…Ø±ÙˆØ±",
      "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 2 - Ø´Ø±ÙŠÙ Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµØ­ÙŠ",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ Ø´Ø§Ø±Ø¹ Ø§Ù„ÙƒØ§Ø¨ØªÙ† - Ø´Ø±ÙŠÙ Ø§Ù„Ø¹Ø²Ø§Ø²ÙŠ",
      "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø§Ù„ Ø´Ù„Ø¨ÙŠØ§ÙŠØ© - Ø£Ø´Ø±Ù Ø§Ù„Ø£Ø¨Ø§ØµÙŠØ±ÙŠ",
      "Ù…ØµÙ†Ø¹ Ø§Ù„Ø¨ØµÙ„ - ÙØ¤Ø§Ø¯ Ø­Ø§Ù„",
      "Ø§Ù„ÙƒÙØ± 1 - Ø¹Ù„ÙŠ Ø´Ø·Ø§",
      "Ø§Ù„ÙƒÙØ± 2 ØªØ­Øª Ø§Ù„Ø³ÙƒØ© - Ø±Ø§Ø¨Ø­ Ø´Ø·Ø§",
      "Ø³ÙˆÙ‚ Ø§Ù„Ø¬Ù…Ù„Ø© - Ø§Ù„Ø³Ø¹ÙŠØ¯ Ø´Ø·Ø§",
      "Ø§Ù„ÙØ¯Ø§Ø¡ 1 - Ø¹Ù…Ø± Ø§Ù„ÙƒÙŠØ§Ù„",
      "Ø§Ù„ÙØ¯Ø§Ø¡ 2 - Ø­Ù…Ø§Ø¯Ù‡ Ø§Ù„ÙƒÙŠØ§Ù„",
      "Ø§Ù„Ø­Ù…Ø²Ø§ÙˆÙŠ - Ø­Ù…Ø§Ø¯Ù‡ Ø§Ù„Ø´Ø±ÙŠ",
      "Ø§Ù„Ø¬Ø±Ù† 1 - Ø¨ÙˆØ¬ÙŠ Ø§Ù„Ø¨Ø±Ø¹ÙŠ",
      "Ø§Ù„Ø¬Ø±Ù† 2 - Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… ÙÙ‡ÙŠØ¯",
      "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù… - ÙŠØ­ÙŠÙ‰ Ø­Ø¨Ù‚",
      "Ø­ÙŠ Ø§Ù„Ø£Ø¹Ø¬Ø§Ù… - Ù…Ø­Ù…Ø¯ Ø£Ø¨Ùˆ Ø±Ø¬Ø¨",
      "Ø§Ù„Ø¹Ø²Ø¨Ø© Ù…Ù†Ø´ÙŠØ© Ù†Ø§ØµØ± - Ø£ÙŠÙ…Ù† Ù‚Ù†Ø¯ÙŠÙ„",
      "Ø§Ù„Ø·ÙˆÙŠÙ„ - Ø£Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø¸ÙŠÙ…",
      "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ 2 Ø§Ù„Ù‡Ø§ÙˆÙŠØ³ - Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø¬ÙŠØ¯",
      "Ø§Ù„ÙÙ‚Ø§Ø¹ÙŠ - Ù…Ø­Ù…Ø¯ Ø­Ø¨ÙŠØ¨",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 2 - Ø§Ù„Ø³ÙŠØ¯ Ø­Ø±Ø§Ø²",
      "Ø­ÙŠ Ø§Ù„Ø¬Ø¨Ø§Ù†Ø© - Ø³Ø¹Ø¯ Ø§Ù„Ø´Ù„ÙˆØ¯ÙŠ",
      "Ø§Ù„ÙƒÙØ± 3 Ø¨Ø¬ÙˆØ§Ø± Ù…Ù„Ø¹Ø¨ Ø¨Ø±Ø´Ù„ÙˆÙ†Ø© - Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©",
      "Ø£Ø¨Ùˆ Ø±Ø´Ø§Ø¯ Ù…Ù‚Ù‡Ù‰ Ø£Ø¨Ùˆ Ø³Ù„ÙŠÙ…Ø§Ù† - Ù…Ø­Ù…Ø¯ Ø±Ø´Ø§Ø¯",
      "Ø­ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ - Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹ÙŠØ¯",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 3 - Ù…Ù†ØµÙˆØ± Ø§Ù„Ø¨Ø¯Ø±ÙŠ"
    ];

    // Ù…ØµÙÙˆÙØ© Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù€ Firebase (ØªØ³ØªØ®Ø¯Ù… Ù„Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±)
    const firebaseKeys = [
      "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 1",
      "Ø§Ù„Ù…Ù†Ø²Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 2",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ Ø´Ø§Ø±Ø¹ Ø§Ù„ÙƒØ§Ø¨ØªÙ†",
      "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø§Ù„ Ø´Ù„Ø¨ÙŠØ§ÙŠØ©",
      "Ù…ØµÙ†Ø¹ Ø§Ù„Ø¨ØµÙ„",
      "Ø§Ù„ÙƒÙØ± 1",
      "Ø§Ù„ÙƒÙØ± 2 ØªØ­Øª Ø§Ù„Ø³ÙƒØ©",
      "Ø³ÙˆÙ‚ Ø§Ù„Ø¬Ù…Ù„Ø©",
      "Ø§Ù„ÙØ¯Ø§Ø¡ 1",
      "Ø§Ù„ÙØ¯Ø§Ø¡ 2",
      "Ø§Ù„Ø­Ù…Ø²Ø§ÙˆÙŠ",
      "Ø§Ù„Ø¬Ø±Ù† 1",
      "Ø§Ù„Ø¬Ø±Ù† 2",
      "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…",
      "Ø­ÙŠ Ø§Ù„Ø£Ø¹Ø¬Ø§Ù…",
      "Ø§Ù„Ø¹Ø²Ø¨Ø© Ù…Ù†Ø´ÙŠØ© Ù†Ø§ØµØ±",
      "Ø§Ù„Ø·ÙˆÙŠÙ„",
      "Ø§Ù„Ø¨Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ 2 Ø§Ù„Ù‡Ø§ÙˆÙŠØ³",
      "Ø§Ù„ÙÙ‚Ø§Ø¹ÙŠ",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 2",
      "Ø­ÙŠ Ø§Ù„Ø¬Ø¨Ø§Ù†Ø©",
      "Ø§Ù„ÙƒÙØ± 3 Ø¨Ø¬ÙˆØ§Ø± Ù…Ù„Ø¹Ø¨ Ø¨Ø±Ø´Ù„ÙˆÙ†Ø©",
      "Ø£Ø¨Ùˆ Ø±Ø´Ø§Ø¯ Ù…Ù‚Ù‡Ù‰ Ø£Ø¨Ùˆ Ø³Ù„ÙŠÙ…Ø§Ù†",
      "Ø­ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡",
      "Ø¨Ø­Ø± Ø§Ù„Ø¨Ù„Ø¯ 3"
    ];

Â  Â  function checkPassword() {
Â  Â  Â  Â  const pass = document.getElementById('passwordInput').value;
Â  Â  Â  Â  if (pass === '251988') {
Â  Â  Â  Â  Â  Â  document.getElementById('loginScreen').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.querySelector('.container').classList.add('visible');
Â  Â  Â  Â  Â  Â  if(window.startListening) window.startListening();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.getElementById('errorMsg').style.display = 'block';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  window.closeModal = function(id) {
Â  Â  Â  Â  document.getElementById(id).style.display = 'none';
Â  Â  }
Â  Â  window.onclick = function(event) {
Â  Â  Â  Â  if (event.target.classList.contains('modal')) {
Â  Â  Â  Â  Â  Â  event.target.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  window.showRepStat = function(name, count) {
Â  Â  Â  Â  document.getElementById('modalRepName').innerText = name;
Â  Â  Â  Â  document.getElementById('modalRepCount').innerText = count;
Â  Â  Â  Â  document.getElementById('repModal').style.display = 'flex';
Â  Â  }

Â  Â  // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø¶Ø§ÙØ©
Â  Â  window.copyToClipboard = function(text, btn) {
Â  Â  Â  Â  navigator.clipboard.writeText(text).then(() => {
Â  Â  Â  Â  Â  Â  let originalText = btn.innerText;
Â  Â  Â  Â  Â  Â  btn.innerText = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
Â  Â  Â  Â  Â  Â  btn.classList.add('copied');
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerText = originalText;
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('copied');
Â  Â  Â  Â  Â  Â  }, 2000);
Â  Â  Â  Â  }).catch(err => console.error('Could not copy', err));
Â  Â  }

Â  Â  // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†ØµØ§Ø¨Ø© Ù…Ø¹ Ø²Ø± Ø§Ù„Ù†Ø³Ø®
Â  Â  window.showNassabaDetails = function(placeKey) {
        // Ù†Ø³ØªØ®Ø¯Ù… Ù…ÙƒØ§Ù† Ø§Ù„Ù€ key ÙÙŠ firebaseKeys Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
        const placeIndex = firebaseKeys.indexOf(placeKey);
        const placeName = placeIndex !== -1 ? places[placeIndex] : placeKey;

Â  Â  Â  Â  if(!window.allStats || !window.allStats[placeKey]) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const list = window.allStats[placeKey].nassabaList;
Â  Â  Â  Â  const container = document.getElementById('nassabaListContainer');
Â  Â  Â  Â  document.getElementById('nassabaPlaceName').innerText = placeName;
Â  Â  Â  Â Â 
Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  list.forEach(item => {
Â  Â  Â  Â  Â  Â  let date = new Date(item.time).toLocaleTimeString('ar-EG');
Â  Â  Â  Â  Â  Â  let li = document.createElement('li');
Â  Â  Â  Â  Â  Â  // Ù‡Ù†Ø§ Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ù†Ø³Ø®
Â  Â  Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="copy-btn" onclick="copyToClipboard('${item.id}', this)">Ù†Ø³Ø®</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ†” <b>${item.id}</b></span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:0.85em; color:#666;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ø¨ÙˆØ§Ø³Ø·Ø©: ${item.by} <br> Ø§Ù„Ø³Ø§Ø¹Ø©: ${date}
Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  container.appendChild(li);
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById('nassabaModal').style.display = 'flex';
Â  Â  }

Â  Â  window.exportToExcel = function() {
Â  Â  Â  Â  if(!window.allStats) { alert("Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹"); return; }

Â  Â  Â  Â  let maxReps = 0;
Â  Â  Â  Â  firebaseKeys.forEach(key => {
Â  Â  Â  Â  Â  Â  let p = window.allStats[key];
Â  Â  Â  Â  Â  Â  if(p && p.reps) {
Â  Â  Â  Â  Â  Â  Â  Â  let count = Object.keys(p.reps).length;
Â  Â  Â  Â  Â  Â  Â  Â  if(count > maxReps) maxReps = count;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  let header = `
Â  Â  Â  Â  Â  Â  <th style="background:#4a90e2; color:white; border:1px solid #000;">Ù…</th>
Â  Â  Â  Â  Â  Â  <th style="background:#4a90e2; color:white; border:1px solid #000;">Ø§Ù„Ù…ÙƒØ§Ù†</th>
Â  Â  Â  Â  Â  Â  <th style="background:#4a90e2; color:white; border:1px solid #000;">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ</th>
Â  Â  Â  Â  Â  Â  <th style="background:#ff4757; color:white; border:1px solid #000;">Ù†ØµØ§Ø¨Ø©</th>
Â  Â  Â  Â  `;
Â  Â  Â  Â  for(let i=1; i<=maxReps; i++) {
Â  Â  Â  Â  Â  Â  header += `<th style="background:#4a90e2; color:white; border:1px solid #000;">Ù…Ù†Ø¯ÙˆØ¨ ${i}</th>`;
Â  Â  Â  Â  Â  Â  header += `<th style="background:#4a90e2; color:white; border:1px solid #000;">Ø¹Ø¯Ø¯ ${i}</th>`;
Â  Â  Â  Â  }
Â  Â  Â  Â  header += `
Â  Â  Â  Â  Â  Â  <th style="background:#4a90e2; color:white; border:1px solid #000;">Ø£ÙˆÙ„ Ø¥Ø¯Ø®Ø§Ù„</th>
Â  Â  Â  Â  Â  Â  <th style="background:#4a90e2; color:white; border:1px solid #000;">Ø¢Ø®Ø± Ø¥Ø¯Ø®Ø§Ù„</th>
Â  Â  Â  Â  Â  Â  <th style="background:#4a90e2; color:white; border:1px solid #000;">Ø§Ù„Ù…Ø¯Ø©</th>
Â  Â  Â  Â  `;

Â  Â  Â  Â  let rows = '';
Â  Â  Â  Â  firebaseKeys.forEach((key, index) => {
Â  Â  Â  Â  Â  Â  let p = window.allStats[key] || {count:0, nassabaList:[], reps:{}, times:[]};
Â  Â  Â  Â  Â  Â  let minTime = p.times.length ? new Date(Math.min(...p.times.map(t=>new Date(t)))).toLocaleTimeString('ar-EG') : '-';
Â  Â  Â  Â  Â  Â  let maxTime = p.times.length ? new Date(Math.max(...p.times.map(t=>new Date(t)))).toLocaleTimeString('ar-EG') : '-';
Â  Â  Â  Â  Â  Â  let diff = (minTime!='-' && maxTime!='-') ? ((new Date(Math.max(...p.times.map(t=>new Date(t)))) - new Date(Math.min(...p.times.map(t=>new Date(t)))))/60000) : null;
Â  Â  Â  Â  Â  Â  let duration = (diff!==null)? `${Math.floor(diff/60)}:${Math.floor(diff%60)}`:'-';

Â  Â  Â  Â  Â  Â  let bgColor = (index % 2 === 0) ? "#ffffff" : "#f9f9f9";

Â  Â  Â  Â  Â  Â  let row = `<tr>
Â  Â  Â  Â  Â  Â  Â  Â  <td style="background:${bgColor}; border:1px solid #000;">${index + 1}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td style="background:${bgColor}; border:1px solid #000;">${places[index]}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td style="background:${bgColor}; border:1px solid #000;">${p.count}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td style="background:${p.nassabaList.length > 0 ? '#ffecec' : bgColor}; color:${p.nassabaList.length > 0 ? 'red' : 'black'}; border:1px solid #000;">${p.nassabaList.length}</td>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  let repEntries = Object.entries(p.reps);
Â  Â  Â  Â  Â  Â  for(let i=0; i<maxReps; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  if(i < repEntries.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row += `<td style="background:${bgColor}; border:1px solid #000;">${repEntries[i][0]}</td>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row += `<td style="background:#dff0d8; color:#2e7d32; font-weight:bold; border:1px solid #000;">${repEntries[i][1].length}</td>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row += `<td style="background:${bgColor}; border:1px solid #000;">-</td><td style="background:${bgColor}; border:1px solid #000;">-</td>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  row += `
Â  Â  Â  Â  Â  Â  Â  Â  <td style="background:${bgColor}; border:1px solid #000;">${minTime}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td style="background:${bgColor}; border:1px solid #000;">${maxTime}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td style="background:${bgColor}; border:1px solid #000;">${duration}</td>
Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  rows += row;
Â  Â  Â  Â  });

Â  Â  Â  Â  let excelFile = `
Â  Â  Â  Â  Â  Â  <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
Â  Â  Â  Â  Â  Â  <head><meta charset="UTF-8"></head>
Â  Â  Â  Â  Â  Â  <body dir="rtl"><table><thead><tr>${header}</tr></thead><tbody>${rows}</tbody></table></body>
Â  Â  Â  Â  Â  Â  </html>
Â  Â  Â  Â  `;
Â  Â  Â  Â  var blob = new Blob([excelFile], { type: 'application/vnd.ms-excel' });
Â  Â  Â  Â  var link = document.createElement("a");
Â  Â  Â  Â  link.href = URL.createObjectURL(blob);
Â  Â  Â  Â  link.download = "Live_Report.xls";
Â  Â  Â  Â  link.click();
Â  Â  }
Â  </script>
</body>
</html>
