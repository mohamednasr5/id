<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ â€“ PDF417</title>

<script src="./dynamsoft-barcode-reader-bundle.js"></script>
<script src="./dynamsoft-barcode-reader-bundle-ml-simd.js"></script>

<style>
  body {
    font-family: Tahoma;
    text-align: center;
    background: #eef2f7;
    padding: 20px;
    margin:0;
  }
  #scanner {
    width: 95%;
    max-width: 480px;
    height: 340px;
    background:black;
    margin: 20px auto;
    border-radius: 14px;
    overflow:hidden;
  }
  #result {
    background:#fff;
    padding:20px;
    border-radius:14px;
    font-size:20px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
  }
</style>
</head>

<body onload="prepareAutoStart()">

<h2>ğŸ“‡ Ù…Ø³Ø­ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…ØµØ±ÙŠØ© â€“ PDF417</h2>

<div id="scanner"></div>

<div id="result">Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§â€¦ Ø§Ù„Ù…Ø³ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</div>

<script>

let scanner = null;
let started = false;

function extractNID(text) {
  const m = text.match(/\d{14}/);
  return m ? m[0] : null;
}

function prepareAutoStart() {
  // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù…Ø¬Ø±Ø¯ ÙŠÙ„Ù…Ø³ Ø§Ù„Ø´Ø§Ø´Ø© â†’ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ø§Ø³Ø­
  document.body.addEventListener("click", startScannerOnce, { once: true });
  document.body.addEventListener("touchstart", startScannerOnce, { once: true });
}

async function startScannerOnce() {
  if (started) return;
  started = true;

  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "ğŸ” Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§â€¦";

  try {
    scanner = await Dynamsoft.DBR.BarcodeScanner.createInstance({
      wasmDir: "./",
      resourceDir: "./"
    });

    await scanner.setUIElement(document.getElementById("scanner"));

    let settings = await scanner.getRuntimeSettings();
    settings.barcodeFormatIds = Dynamsoft.DBR.EnumBarcodeFormat.BF_PDF417;
    await scanner.updateRuntimeSettings(settings);

    scanner.onFrameRead = results => {
      for (let r of results) {
        const raw = r.barcodeText;
        const nid = extractNID(raw);
        if (nid) {
          resultDiv.innerHTML = `
            <p>âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</p>
            <h3>${nid}</h3>
          `;
          scanner.stop();
        }
      }
    };

    await scanner.show();
    resultDiv.innerHTML = "ğŸ“· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø§Ù‡Ø²Ø© â€” ÙˆØ¬Ù‘Ù‡ Ø¸Ù‡Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¢Ù†";

  } catch (e) {
    resultDiv.innerHTML = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + e.message;
  }
}

</script>

</body>
</html>
