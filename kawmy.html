<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ماسح بطاقة الرقم القومي المصري</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@10.3.0/dist/dbr.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
    background: #eef2f5;
    font-family: 'Cairo', sans-serif;
    text-align: center;
    padding: 25px;
}

#scanner {
    width: 350px;
    height: 350px;
    margin: 0 auto;
    border: 3px solid #0f3c67;
    border-radius: 12px;
    overflow: hidden;
}

input {
    width: 350px;
    padding: 12px;
    margin-top: 15px;
    font-size: 22px;
    text-align: center;
    border-radius: 10px;
    border: 2px solid #0f3c67;
    background: #fff;
}

#success {
    display: none;
    background: #0f3c67;
    color: #fff;
    padding: 12px;
    margin-top: 15px;
    border-radius: 10px;
}

button {
    margin-top: 15px;
    background: #0f3c67;
    padding: 10px 16px;
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
}
</style>
</head>

<body>

<h2>قارئ بطاقة الرقم القومي المصري (DataMatrix)</h2>

<div id="scanner"></div>

<input id="nid" type="text" placeholder="الرقم القومي يظهر تلقائيًا">

<div id="success">✔️ تمت قراءة الرقم القومي بنجاح</div>

<button onclick="restart()">إعادة تشغيل الماسح</button>

<script>
function toArabic(n){
    return n.replace(/[0-9]/g, d=>"٠١٢٣٤٥٦٧٨٩"[d]);
}

let scanner;

async function start() {
    try {

        scanner = await Dynamsoft.BarcodeScanner.createInstance({
            license: "DLS2eyJoYW5kc2hha2VDb2RlIjoiMTA0ODY2MTM2LU1UQTBPRFkyTVRNMkxYZGxZaTFVY21saGJGQnliMm8iLCJtYWluU2VydmVyVVJMIjoiaHR0cHM6Ly9tZGxzLmR5bmFtc29mdG9ubGluZS5jb20iLCJvcmdhbml6YXRpb25JRCI6IjEwNDg2NjEzNiIsInN0YW5kYnlTZXJ2ZXJVUkwiOiJodHRwczovL3NkbHMuZHluYW1zb2Z0b25saW5lLmNvbSIsImNoZWNrQ29kZSI6LTE3MDIzNzIyNzh9",
            videoSettings: { facingMode: "environment" }
        });

        scanner.onFrameRead = results => {
            if (results.length === 0) return;

            let raw = results[0].barcodeText;
            raw = raw.replace(/\D/g, "").substring(0, 14);

            document.getElementById("nid").value = toArabic(raw);
            document.getElementById("success").style.display = "block";

            scanner.stop();
        };

        await scanner.setUIElement(document.getElementById("scanner"));
        await scanner.open();
    } 
    catch (err) {
        console.error(err);
        alert("خطأ في تشغيل الماسح أو الكاميرا!");
    }
}

async function restart() {
    document.getElementById("success").style.display = "none";
    document.getElementById("nid").value = "";
    await scanner.open();
}

start();
</script>

</body>
</html>
