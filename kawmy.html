<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ماسح باركود PDF417 مجاني</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/@zxing/browser@latest"></script>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
    background: #eef2f5;
    font-family: 'Cairo', sans-serif;
    text-align: center;
    padding: 25px;
}

video {
    width: 350px;
    border: 3px solid #0f3c67;
    border-radius: 12px;
    background: #000;
}

input {
    width: 350px;
    padding: 12px;
    margin-top: 15px;
    font-size: 22px;
    text-align: center;
    border-radius: 10px;
    border: 2px solid #0f3c67;
    background: #fff;
}

#success {
    display: none;
    background: #0f3c67;
    color: #fff;
    padding: 12px;
    margin-top: 15px;
    border-radius: 10px;
}
</style>
</head>

<body>

<h2>قارئ بطاقة الرقم القومي — PDF417 (مجاني)</h2>

<video id="preview"></video>

<input id="nid" type="text" placeholder="الرقم القومي يظهر هنا تلقائيًا">

<div id="success">✔️ تمت قراءة الرقم القومي بنجاح</div>

<script>
function toArabic(n){
    return n.replace(/[0-9]/g, d=>"٠١٢٣٤٥٦٧٨٩"[d]);
}

const codeReader = new ZXingBrowser.BrowserPDF417Reader();
const video = document.getElementById("preview");

async function startScanner() {

    try {
        const devices = await ZXingBrowser.BrowserCodeReader.listVideoInputDevices();
        
        const backCam = devices.find(d => d.label.includes("back"))?.deviceId || devices[0].deviceId;

        codeReader.decodeFromVideoDevice(backCam, video, (result, err) => {

            if (result) {
                let raw = result.getText().trim();

                // استخراج أول 14 رقم فقط
                raw = raw.replace(/\D/g, "").substring(0, 14);

                document.getElementById("nid").value = toArabic(raw);
                document.getElementById("success").style.display = "block";

                codeReader.reset();
            }
        });

    } catch (e) {
        alert("تعذر تشغيل الكاميرا!");
        console.error(e);
    }
}

startScanner();
</script>

</body>
</html>
