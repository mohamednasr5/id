<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø³Ø­ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ â€“ PDF417</title>

<!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Dynamsoft Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù„Ù‰ GitHub -->
<script src="./dynamsoft-barcode-reader-bundle.js"></script>
<script src="./dynamsoft-barcode-reader-bundle-ml-simd.js"></script>

<style>
  body {
    font-family: Tahoma;
    background: #eef2f7;
    text-align: center;
    padding: 20px;
  }
  #scanner {
    width: 95%;
    max-width: 450px;
    height: 320px;
    background: black;
    margin: 20px auto;
    border-radius: 14px;
    overflow: hidden;
  }
  #result {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
    font-size: 20px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
  }
  button {
    margin-top: 20px;
    padding: 10px 25px;
    border: none;
    background: #007bff;
    color: white;
    border-radius: 8px;
    cursor: pointer;
    font-size: 18px;
  }
</style>

</head>
<body>

<h2>ğŸ“‡ Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…ØµØ±ÙŠØ©</h2>

<div id="scanner"></div>
<div id="result">Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ù„ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</div>

<button onclick="startScan()">â–¶ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­</button>

<script>

function extractNID(text) {
  const m = text.match(/\d{14}/);
  return m ? m[0] : null;
}

async function startScan() {
  document.getElementById("result").innerHTML = "ğŸ” Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...";

  const scanner = await Dynamsoft.DBR.BarcodeScanner.createInstance({
    wasmDir: "./",
    resourceDir: "./"
  });

  await scanner.setUIElement(document.getElementById("scanner"));

  let settings = await scanner.getRuntimeSettings();
  settings.barcodeFormatIds = Dynamsoft.DBR.EnumBarcodeFormat.BF_PDF417;
  await scanner.updateRuntimeSettings(settings);

  scanner.onFrameRead = results => {
    for (let r of results) {
      const raw = r.barcodeText;
      const nid = extractNID(raw);
      if (nid) {
        document.getElementById("result").innerHTML = `
          <p>âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</p>
          <h3>${nid}</h3>
        `;
        scanner.stop();
        return;
      }
    }
  };

  await scanner.show();
}

</script>

</body>
</html>
