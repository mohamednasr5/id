Download now!
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ماسح الرقم القومي</title>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<style>
body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background-color: #f4f4f4;
display: flex;
flex-direction: column;
align-items: center;
padding: 20px;
margin: 0;
}
.container {
background: white;
padding: 20px;
border-radius: 12px;
box-shadow: 0 4px 6px rgba(0,0,0,0.1);
width: 100%;
max-width: 500px;
text-align: center;
}
h2 { margin-bottom: 20px; color: #333; }

#reader {
width: 100%;
border-radius: 8px;
overflow: hidden;
background: #000;
margin-bottom: 15px;
min-height: 300px; /* مكان الكاميرا */
}

input {
width: 90%;
padding: 15px;
font-size: 20px;
text-align: center;
border: 2px solid #ddd;
border-radius: 8px;
margin-bottom: 15px;
letter-spacing: 2px;
font-weight: bold;
}

button {
background-color: #28a745;
color: white;
border: none;
padding: 12px 25px;
font-size: 18px;
border-radius: 8px;
cursor: pointer;
width: 100%;
margin-bottom: 10px;
}
button#stop-btn { background-color: #dc3545; display: none; }

.hint { color: #666; font-size: 14px; margin-top: 10px; }
</style>
</head>
<body>

<div class="container">
<h2>قارئ الرقم القومي</h2>

<div id="reader"></div>

<input type="text" id="nationalID" placeholder="الرقم سيظهر هنا" readonly>

<button id="start-btn" onclick="startScanner()">تشغيل الكاميرا</button>
<button id="stop-btn" onclick="stopScanner()">إيقاف الكاميرا</button>

<p class="hint">وجه الكاميرا على الباركود الأسود في <b>ظهر البطاقة</b></p>
</div>

<script>
let html5QrcodeScanner;

function startScanner() {
document.getElementById('start-btn').style.display = 'none';
document.getElementById('stop-btn').style.display = 'block';
document.getElementById('nationalID').value = ''; // تفريغ الحقل

html5QrcodeScanner = new Html5Qrcode("reader");

// إعدادات المسح
const config = {
fps: 10, // عدد الإطارات في الثانية
qrbox: { width: 300, height: 150 }, // مستطيل التركيز (عريض ليناسب الباركود)
aspectRatio: 1.0,
// التركيز فقط على صيغة PDF_417 الموجودة في البطاقة المصرية لزيادة السرعة
formatsToSupport: [ Html5QrcodeSupportedFormats.PDF_417 ]
};

// تشغيل الكاميرا الخلفية
html5QrcodeScanner.start(
{ facingMode: "environment" },
config,
onScanSuccess,
onScanFailure
).catch(err => {
console.error("فشل تشغيل الكاميرا", err);
alert("يرجى السماح باستخدام الكاميرا أو التأكد من أن الموقع يعمل ببروتوكول HTTPS");
stopScanner();
});
}

function onScanSuccess(decodedText, decodedResult) {
console.log(Scan result: ${decodedText});

// استخراج الـ 14 رقم من النص المقروء
// الباركود قد يحتوي على بيانات إضافية، هذا الكود يستخرج أول 14 رقم متصل
const idMatch = decodedText.match(/\d{14}/);

if (idMatch) {
// 1. وضع الرقم في الحقل
document.getElementById('nationalID').value = idMatch[0];

// 2. تشغيل صوت وتنبيه اهتزاز (اختياري لتحسين التجربة)
if (navigator.vibrate) navigator.vibrate(200); // اهتزاز للموبايل
playBeep();

// 3. إيقاف المسح تلقائياً
stopScanner();

alert("تم التقاط الرقم: " + idMatch[0]);
}
}

function onScanFailure(error) {
// هذه الدالة تعمل باستمرار عند عدم وجود كود، لا تفعل شيئاً هنا لتجنب الإزعاج
// console.warn(Code scan error = ${error});
}

function stopScanner() {
if (html5QrcodeScanner) {
html5QrcodeScanner.stop().then(() => {
html5QrcodeScanner.clear();
document.getElementById('start-btn').style.display = 'block';
document.getElementById('stop-btn').style.display = 'none';
}).catch(err => {
console.log("Failed to stop", err);
});
}
}

// دالة صوت بسيط
function playBeep() {
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const oscillator = audioCtx.createOscillator();
const gainNode = audioCtx.createGain();
oscillator.connect(gainNode);
gainNode.connect(audioCtx.destination);
oscillator.type = "sine";
oscillator.frequency.setValueAtTime(800, audioCtx.currentTime); // التردد
oscillator.start();
setTimeout(() => oscillator.stop(), 150); // مدة الصوت
}
</script>

</body>
</html>
