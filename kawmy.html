<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ PDF417</title>
<script src="https://unpkg.com/@zxing/browser@latest"></script>
<style>
  body { font-family: Tahoma; text-align: center; background:#f2f2f2; padding:20px; }
  video { width: 90%; max-width: 400px; border: 2px solid #444; border-radius: 10px; }
  #result { margin-top: 20px; padding: 15px; background: white; border-radius: 10px; }
</style>
</head>

<body>

<h2>ðŸ“‡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù…Ù† Ø¨Ø§Ø±ÙƒÙˆØ¯ PDF417</h2>

<video id="preview" autoplay playsinline></video>

<div id="result">Ù‚Ù… Ø¨ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>

<script>
  const preview = document.getElementById("preview");
  const resultBox = document.getElementById("result");

  // Ù…Ø³Ø­ PDF417
  const reader = new ZXing.BrowserPDF417Reader();

  async function startScanner() {
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª
    const cams = await ZXing.BrowserCodeReader.listVideoInputDevices();
    const backCam =
      cams.find(c => c.label.toLowerCase().includes("back")) || cams[0];

    // Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ù…Ø³Ø­ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    reader.decodeFromVideoDevice(backCam.deviceId, preview, (res, err) => {
      if (res) {
        const rawText = res.text; // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù… Ù…Ù† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù…Ù† Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ
        const nationalID = extractNID(rawText);

        if (nationalID) {
          resultBox.innerHTML = `
            <b>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</b><br>
            <h2>${nationalID}</h2>
          `;
        } else {
          resultBox.innerHTML = `<b>ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ ØµØ§Ù„Ø­.</b>`;
        }
      }
    });
  }

  // Ø¯Ø§Ù„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù… Ù…ØªØªØ§Ù„ÙŠ)
  function extractNID(text) {
    const match = text.match(/\d{14}/);
    return match ? match[0] : null;
  }

  startScanner();
</script>

</body>
</html>
