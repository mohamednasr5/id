<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ â€“ PDF417</title>

<!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Dynamsoft Ù…Ù† Ù†ÙØ³ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±ÙŠØ¨Ùˆ -->
<script src="./dynamsoft-barcode-reader-bundle.js"></script>
<script src="./dynamsoft-barcode-reader-bundle-ml-simd.js"></script>

<style>
  body {
    font-family: Tahoma;
    text-align: center;
    background: #f3f3f3;
    padding: 20px;
  }
  #scanner {
    width: 95%;
    max-width: 450px;
    height: 320px;
    background: #000;
    border-radius: 12px;
    margin: 20px auto;
  }
  #result {
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin-top: 20px;
    font-size: 20px;
    box-shadow: 0 0 10px rgba(0,0,0,0.15);
  }
  button {
    padding: 10px 28px;
    font-size: 18px;
    border: none;
    background: #007bff;
    color: white;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
  }
</style>

</head>
<body>

<h2>ðŸ“‡ Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…ØµØ±ÙŠØ© â€“ PDF417</h2>

<div id="scanner"></div>

<div id="result">Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡" Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</div>

<button onclick="startScan()">â–¶ Ø¨Ø¯Ø¡</button>

<script>

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„ÙƒØ§Ù…Ù„
function extractNID(text) {
  const m = text.match(/\d{14}/);
  return m ? m[0] : null;
}

async function startScan() {

  document.getElementById("result").innerHTML = "ðŸ” Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§â€¦";

  // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø§Ø³Ø­
  const scanner = await Dynamsoft.DBR.BarcodeScanner.createInstance({
      wasmDir: "./",
      resourceDir: "./"
  });

  // Ø±Ø¨Ø· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¯Ø§Ø®Ù„ DIV
  await scanner.setUIElement(document.getElementById("scanner"));

  // Ù…Ø³Ø­ PDF417 ÙÙ‚Ø·
  let settings = await scanner.getRuntimeSettings();
  settings.barcodeFormatIds = Dynamsoft.DBR.EnumBarcodeFormat.BF_PDF417;
  await scanner.updateRuntimeSettings(settings);

  // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
  await scanner.show();

  // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  scanner.onFrameRead = results => {
    for (let r of results) {
      const raw = r.barcodeText;
      const nid = extractNID(raw);

      if (nid) {
        document.getElementById("result").innerHTML = `
          <p>âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</p>
          <h2>${nid}</h2>
        `;
        scanner.stop();
      }
    }
  };
}

</script>

</body>
</html>
